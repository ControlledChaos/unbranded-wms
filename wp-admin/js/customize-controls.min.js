(function(e,t){var n,i,a,o,s,r,c,l=wp.customize;l.OverlayNotification=l.Notification.extend({loading:!1,initialize:function(e,t){var n=this;l.Notification.prototype.initialize.call(n,e,t),n.containerClasses+=" notification-overlay",n.loading&&(n.containerClasses+=" notification-loading")},render:function(){var e=l.Notification.prototype.render.call(this);return e.on("keydown",_.bind(this.handleEscape,this)),e},handleEscape:function(e){var t=this;27===e.which&&(e.stopPropagation(),t.dismissible&&t.parent&&t.parent.remove(t.code))}}),l.Notifications=l.Values.extend({alt:!1,defaultConstructor:l.Notification,initialize:function(e){var t=this;l.Values.prototype.initialize.call(t,e),_.bindAll(t,"constrainFocus"),t._addedIncrement=0,t._addedOrder={},t.bind("add",function(e){t.trigger("change",e)}),t.bind("removed",function(e){t.trigger("change",e)})},count:function(){return _.size(this._value)},add:function(e,t){var n,i,a=this;return"string"==typeof e?(n=e,i=t):(n=e.code,i=e),a.has(n)||(a._addedIncrement+=1,a._addedOrder[n]=a._addedIncrement),l.Values.prototype.add.call(a,n,i)},remove:function(e){var t=this;return delete t._addedOrder[e],l.Values.prototype.remove.call(this,e)},get:function(e){var t,n,i,a=this;return t=_.values(a._value),i=_.extend({sort:!1},e),i.sort&&(n={error:4,warning:3,success:2,info:1},t.sort(function(e,t){var i=0,o=0;return _.isUndefined(n[e.type])||(i=n[e.type]),_.isUndefined(n[t.type])||(o=n[t.type]),i!==o?o-i:a._addedOrder[t.code]-a._addedOrder[e.code]})),t},render:function(){var e,n,i,a,o=this,s=!1,r=[],c={};o.container&&o.container.length&&(e=o.get({sort:!0}),o.container.toggle(0!==e.length),o.container.is(o.previousContainer)&&_.isEqual(e,o.previousNotifications)||(i=o.container.children("ul").first(),i.length||(i=t("<ul></ul>"),o.container.append(i)),i.find("> [data-code]").remove(),_.each(o.previousNotifications,function(e){c[e.code]=e}),_.each(e,function(e){var n;!wp.a11y||c[e.code]&&_.isEqual(e.message,c[e.code].message)||wp.a11y.speak(e.message,"assertive"),n=t(e.render()),e.container=n,i.append(n),e.extended(l.OverlayNotification)&&r.push(e)}),n=Boolean(r.length),o.previousNotifications&&(s=Boolean(_.find(o.previousNotifications,function(e){return e.extended(l.OverlayNotification)}))),n!==s&&(t(document.body).toggleClass("customize-loading",n),o.container.toggleClass("has-overlay-notifications",n),n?(o.previousActiveElement=document.activeElement,t(document).on("keydown",o.constrainFocus)):t(document).off("keydown",o.constrainFocus)),n?(o.focusContainer=r[r.length-1].container,o.focusContainer.prop("tabIndex",-1),a=o.focusContainer.find(":focusable"),a.length?a.first().focus():o.focusContainer.focus()):o.previousActiveElement&&(t(o.previousActiveElement).focus(),o.previousActiveElement=null),o.previousNotifications=e,o.previousContainer=o.container,o.trigger("rendered")))},constrainFocus:function(e){var n,i=this;e.stopPropagation(),9===e.which&&(n=i.focusContainer.find(":focusable"),0===n.length&&(n=i.focusContainer),t.contains(i.focusContainer[0],e.target)&&t.contains(i.focusContainer[0],document.activeElement)?n.last().is(e.target)&&!e.shiftKey?(e.preventDefault(),n.first().focus()):n.first().is(e.target)&&e.shiftKey&&(e.preventDefault(),n.last().focus()):(e.preventDefault(),n.first().focus()))}}),l.Setting=l.Value.extend({defaults:{transport:"refresh",dirty:!1},initialize:function(e,t,n){var i,a=this;i=_.extend({previewer:l.previewer},a.defaults,n||{}),l.Value.prototype.initialize.call(a,t,i),a.id=e,a._dirty=i.dirty,a.notifications=new l.Notifications,a.bind(a.preview)},preview:function(){var e,t=this;e=t.transport,"postMessage"!==e||l.state("previewerAlive").get()||(e="refresh"),"postMessage"===e?t.previewer.send("setting",[t.id,t()]):"refresh"===e&&t.previewer.refresh()},findControls:function(){var e=this,t=[];return l.control.each(function(n){_.each(n.settings,function(i){i.id===e.id&&t.push(n)})}),t}}),l._latestRevision=0,l._lastSavedRevision=0,l._latestSettingRevisions={},l.bind("change",function(e){l._latestRevision+=1,l._latestSettingRevisions[e.id]=l._latestRevision}),l.bind("ready",function(){l.bind("add",function(e){e._dirty&&(l._latestRevision+=1,l._latestSettingRevisions[e.id]=l._latestRevision)})}),l.dirtyValues=function(e){var t={};return l.each(function(n){var i;n._dirty&&(i=l._latestSettingRevisions[n.id],l.state("changesetStatus").get()&&e&&e.unsaved&&(_.isUndefined(i)||i<=l._lastSavedRevision)||(t[n.id]=n.get()))}),t},l.requestChangesetUpdate=function(e,n){var i,a,o,s,r={};return i=new t.Deferred,0!==l.state("processing").get()?(i.reject("already_processing"),i.promise()):(s=_.extend({title:null,date:null,autosave:!1,force:!1},n),e&&_.extend(r,e),_.each(l.dirtyValues({unsaved:!0}),function(t,n){e&&null===e[n]||(r[n]=_.extend({},r[n]||{},{value:t}))}),l.trigger("changeset-save",r,s),!s.force&&_.isEmpty(r)&&null===s.title&&null===s.date?(i.resolve({}),i.promise()):s.status?i.reject({code:"illegal_status_in_changeset_update"}).promise():s.date&&s.autosave?i.reject({code:"illegal_autosave_with_date_gmt"}).promise():(l.state("processing").set(l.state("processing").get()+1),i.always(function(){l.state("processing").set(l.state("processing").get()-1)}),o=l.previewer.query({excludeCustomizedSaved:!0}),delete o.customized,_.extend(o,{nonce:l.settings.nonce.save,customize_theme:l.settings.theme.stylesheet,customize_changeset_data:JSON.stringify(r)}),null!==s.title&&(o.customize_changeset_title=s.title),null!==s.date&&(o.customize_changeset_date=s.date),!1!==s.autosave&&(o.customize_changeset_autosave="true"),l.trigger("save-request-params",o),a=wp.ajax.post("customize_save",o),a.done(function(e){var t={};l._lastSavedRevision=Math.max(l._latestRevision,l._lastSavedRevision),l.state("changesetStatus").set(e.changeset_status),e.changeset_date&&l.state("changesetDate").set(e.changeset_date),i.resolve(e),l.trigger("changeset-saved",e),e.setting_validities&&_.each(e.setting_validities,function(e,n){!0===e&&_.isObject(r[n])&&!_.isUndefined(r[n].value)&&(t[n]=r[n].value)}),l.previewer.send("changeset-saved",_.extend({},e,{saved_changeset_values:t}))}),a.fail(function(e){i.reject(e),l.trigger("changeset-error",e)}),a.always(function(e){e.setting_validities&&l._handleSettingValidities({settingValidities:e.setting_validities})}),i.promise()))},l.utils.bubbleChildValueChanges=function(e,n){t.each(n,function(t,n){e[n].bind(function(t,n){e.parent&&t!==n&&e.parent.trigger("change",e)})})},i=function(e){var t,n,i,a;t=this,e=e||{},i=function(){var e;e=(t.extended(l.Panel)||t.extended(l.Section))&&t.expanded&&t.expanded()?t.contentContainer:t.container,a=e.find(".control-focus:first"),0===a.length&&(a=e.find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible").first()),a.focus()},e.completeCallback?(n=e.completeCallback,e.completeCallback=function(){i(),n()}):e.completeCallback=i,l.state("paneVisible").set(!0),t.expand?t.expand(e):e.completeCallback()},l.utils.prioritySort=function(e,t){return e.priority()===t.priority()&&"number"==typeof e.params.instanceNumber&&"number"==typeof t.params.instanceNumber?e.params.instanceNumber-t.params.instanceNumber:e.priority()-t.priority()},l.utils.isKeydownButNotEnterEvent=function(e){return"keydown"===e.type&&13!==e.which},l.utils.areElementListsEqual=function(e,n){var i=e.length===n.length&&-1===_.indexOf(_.map(_.zip(e,n),function(e){return t(e[0]).is(e[1])}),!1);return i},l.utils.highlightButton=function(e,t){function n(){o=!0}var i,a="button-see-me",o=!1;return i=_.extend({delay:0,focusTarget:e},t),i.focusTarget.on("focusin",n),setTimeout(function(){i.focusTarget.off("focusin",n),o||(e.addClass(a),e.one("animationend",function(){e.removeClass(a)}))},i.delay),n},l.utils.getCurrentTimestamp=function(){var e,t,n;return t=_.now(),e=new Date(l.settings.initialServerDate.replace(/-/g,"/")),n=t-l.settings.initialClientTimestamp,n+=l.settings.initialClientTimestamp-l.settings.initialServerTimestamp,e.setTime(e.getTime()+n),e.getTime()},l.utils.getRemainingTime=function(e){var t,n,i=1e3;return n=e instanceof Date?e.getTime():"string"==typeof e?new Date(e.replace(/-/g,"/")).getTime():e,t=n-l.utils.getCurrentTimestamp(),t=Math.ceil(t/i),t},o=document.createElement("div"),s={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},r=_.find(_.keys(s),function(e){return!_.isUndefined(o.style[e])}),a=r?s[r]:null,n=l.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:t.noop},defaultExpandedArguments:{duration:"fast",completeCallback:t.noop},containerType:"container",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null},initialize:function(e,i){var a=this;a.id=e,n.instanceCounter||(n.instanceCounter=0),n.instanceCounter++,t.extend(a,{params:_.defaults(i.params||i,a.defaults)}),a.params.instanceNumber||(a.params.instanceNumber=n.instanceCounter),a.notifications=new l.Notifications,a.templateSelector=a.params.templateId||"customize-"+a.containerType+"-"+a.params.type,a.container=t(a.params.content),0===a.container.length&&(a.container=t(a.getContainer())),a.headContainer=a.container,a.contentContainer=a.getContent(),a.container=a.container.add(a.contentContainer),a.deferred={embedded:new t.Deferred},a.priority=new l.Value,a.active=new l.Value,a.activeArgumentsQueue=[],a.expanded=new l.Value,a.expandedArgumentsQueue=[],a.active.bind(function(e){var n=a.activeArgumentsQueue.shift();n=t.extend({},a.defaultActiveArguments,n),e=e&&a.isContextuallyActive(),a.onChangeActive(e,n)}),a.expanded.bind(function(e){var n=a.expandedArgumentsQueue.shift();n=t.extend({},a.defaultExpandedArguments,n),a.onChangeExpanded(e,n)}),a.deferred.embedded.done(function(){a.setupNotifications(),a.attachEvents()}),l.utils.bubbleChildValueChanges(a,["priority","active"]),a.priority.set(a.params.priority),a.active.set(a.params.active),a.expanded.set(!1)},getNotificationsContainerElement:function(){var e=this;return e.contentContainer.find(".customize-control-notifications-container:first")},setupNotifications:function(){var e,t=this;t.notifications.container=t.getNotificationsContainerElement(),e=function(){t.expanded.get()&&t.notifications.render()},t.expanded.bind(e),e(),t.notifications.bind("change",_.debounce(e))},ready:function(){},_children:function(e,t){var n=this,i=[];return l[t].each(function(t){t[e].get()===n.id&&i.push(t)}),i.sort(l.utils.prioritySort),i},isContextuallyActive:function(){throw new Error("Container.isContextuallyActive() must be overridden in a subclass.")},onChangeActive:function(e,n){var i,a=this,o=a.headContainer;n.unchanged?n.completeCallback&&n.completeCallback():(i="resolved"===l.previewer.deferred.active.state()?n.duration:0,a.extended(l.Panel)&&(l.panel.each(function(e){e!==a&&e.expanded()&&(e,i=0)}),e||_.each(a.sections(),function(e){e.collapse({duration:0})})),t.contains(document,o.get(0))?e?o.slideDown(i,n.completeCallback):a.expanded()?a.collapse({duration:i,completeCallback:function(){o.slideUp(i,n.completeCallback)}}):o.slideUp(i,n.completeCallback):(o.toggle(e),n.completeCallback&&n.completeCallback()))},_toggleActive:function(e,t){var n=this;return t=t||{},e&&this.active.get()||!e&&!this.active.get()?(t.unchanged=!0,n.onChangeActive(n.active.get(),t),!1):(t.unchanged=!1,this.activeArgumentsQueue.push(t),this.active.set(e),!0)},activate:function(e){return this._toggleActive(!0,e)},deactivate:function(e){return this._toggleActive(!1,e)},onChangeExpanded:function(){throw new Error("Must override with subclass.")},_toggleExpanded:function(e,t){var n,i=this;return t=t||{},n=t.completeCallback,!(e&&!i.active())&&(l.state("paneVisible").set(!0),t.completeCallback=function(){n&&n.apply(i,arguments),e?i.container.trigger("expanded"):i.container.trigger("collapsed")},e&&i.expanded.get()||!e&&!i.expanded.get()?(t.unchanged=!0,i.onChangeExpanded(i.expanded.get(),t),!1):(t.unchanged=!1,i.expandedArgumentsQueue.push(t),i.expanded.set(e),!0))},expand:function(e){return this._toggleExpanded(!0,e)},collapse:function(e){return this._toggleExpanded(!1,e)},_animateChangeExpanded:function(e){if(a){var n,i,o,s=this,r=s.contentContainer,c=r.closest(".wp-full-overlay");n=c.add(r),o=!s.panel||""===s.panel()||!!l.panel(s.panel()).contentContainer.hasClass("skip-transition"),o&&(n=n.add("#customize-info, .customize-pane-parent")),i=function(o){2===o.eventPhase&&t(o.target).is(r)&&(r.off(a,i),n.removeClass("busy"),e&&e())},r.on(a,i),n.addClass("busy"),_.defer(function(){var e=r.closest(".wp-full-overlay-sidebar-content"),t=e.scrollTop(),n=r.data("previous-scrollTop")||0,i=s.expanded();i&&0<t?(r.css("top",t+"px"),r.data("previous-scrollTop",t)):!i&&0<t+n&&(r.css("top",n-t+"px"),e.scrollTop(n))})}else e&&e()},focus:i,getContainer:function(){var e,n=this;return e=0!==t("#tmpl-"+n.templateSelector).length?wp.template(n.templateSelector):wp.template("customize-"+n.containerType+"-default"),e&&n.container?t.trim(e(_.extend({id:n.id},n.params))):"<li></li>"},getContent:function(){var e=this,t=e.container,n=t.find(".accordion-section-content, .control-panel-content").first(),i="sub-"+t.attr("id"),a=i,o=t.attr("aria-owns");return o&&(a=a+" "+o),t.attr("aria-owns",a),n.detach().attr({id:i,class:"customize-pane-child "+n.attr("class")+" "+t.attr("class")})}}),l.Section=n.extend({containerType:"section",containerParent:"#customize-theme-controls",containerPaneParent:".customize-pane-parent",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null,panel:null,customizeAction:""},initialize:function(e,i){var a,o=this;a=i.params||i,a.type||_.find(l.sectionConstructor,function(e,t){return e===o.constructor&&(a.type=t,!0)}),n.prototype.initialize.call(o,e,a),o.id=e,o.panel=new l.Value,o.panel.bind(function(e){t(o.headContainer).toggleClass("control-subsection",!!e)}),o.panel.set(o.params.panel||""),l.utils.bubbleChildValueChanges(o,["panel"]),o.embed(),o.deferred.embedded.done(function(){o.ready()})},embed:function(){var e,t=this;t.containerParent=l.ensure(t.containerParent),e=function(e){var n;e?l.panel(e,function(e){e.deferred.embedded.done(function(){n=e.contentContainer,t.headContainer.parent().is(n)||n.append(t.headContainer),t.contentContainer.parent().is(t.headContainer)||t.containerParent.append(t.contentContainer),t.deferred.embedded.resolve()})}):(n=l.ensure(t.containerPaneParent),t.headContainer.parent().is(n)||n.append(t.headContainer),t.contentContainer.parent().is(t.headContainer)||t.containerParent.append(t.contentContainer),t.deferred.embedded.resolve())},t.panel.bind(e),e(t.panel.get())},attachEvents:function(){var e,n,i=this;i.container.hasClass("cannot-expand")||(i.container.find(".accordion-section-title, .customize-section-back").on("click keydown",function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),i.expanded()?i.collapse():i.expand())}),i.container.find(".customize-section-title .customize-help-toggle").on("click",function(){e=i.container.find(".section-meta"),e.hasClass("cannot-expand")||(n=e.find(".customize-section-description:first"),n.toggleClass("open"),n.slideToggle(i.defaultExpandedArguments.duration,function(){n.trigger("toggled")}),t(this).attr("aria-expanded",function(e,t){return"true"===t?"false":"true"}))}))},isContextuallyActive:function(){var e=this,t=e.controls(),n=0;return _(t).each(function(e){e.active()&&(n+=1)}),0!==n},controls:function(){return this._children("section","control")},onChangeExpanded:function(e,n){var i,a,o=this,s=o.headContainer.closest(".wp-full-overlay-sidebar-content"),r=o.contentContainer,c=o.headContainer.closest(".wp-full-overlay"),d=r.find(".customize-section-back"),u=o.headContainer.find(".accordion-section-title").first();e&&!r.hasClass("open")?(i=n.unchanged?n.completeCallback:t.proxy(function(){o._animateChangeExpanded(function(){u.attr("tabindex","-1"),d.attr("tabindex","0"),d.focus(),r.css("top",""),s.scrollTop(0),n.completeCallback&&n.completeCallback()}),r.addClass("open"),c.addClass("section-open"),l.state("expandedSection").set(o)},this),n.allowMultiple||l.section.each(function(e){e!==o&&e.collapse({duration:n.duration})}),o.panel()?l.panel(o.panel()).expand({duration:n.duration,completeCallback:i}):(n.allowMultiple||l.panel.each(function(e){e.collapse()}),i())):!e&&r.hasClass("open")?(o.panel()&&(a=l.panel(o.panel()),a.contentContainer.hasClass("skip-transition")&&a.collapse()),o._animateChangeExpanded(function(){d.attr("tabindex","-1"),u.attr("tabindex","0"),u.focus(),r.css("top",""),n.completeCallback&&n.completeCallback()}),r.removeClass("open"),c.removeClass("section-open"),o===l.state("expandedSection").get()&&l.state("expandedSection").set(!1)):n.completeCallback&&n.completeCallback()}}),l.ThemesSection=l.Section.extend({currentTheme:"",overlay:"",template:"",screenshotQueue:null,$window:null,$body:null,loaded:0,loading:!1,fullyLoaded:!1,term:"",tags:"",nextTerm:"",nextTags:"",filtersHeight:0,headerContainer:null,updateCountDebounced:null,initialize:function(e,n){var i=this;i.headerContainer=t(),i.$window=t(window),i.$body=t(document.body),l.Section.prototype.initialize.call(i,e,n),i.updateCountDebounced=_.debounce(i.updateCount,500)},embed:function(){var e,t=this;e=function(e){var n;l.panel(e,function(e){e.deferred.embedded.done(function(){n=e.contentContainer,t.headContainer.parent().is(n)||n.find(".customize-themes-full-container-container").before(t.headContainer),t.contentContainer.parent().is(t.headContainer)||t.containerParent.append(t.contentContainer),t.deferred.embedded.resolve()})})},t.panel.bind(e),e(t.panel.get())},ready:function(){var e=this;e.overlay=e.container.find(".theme-overlay"),e.template=wp.template("customize-themes-details-view"),e.container.on("keydown",function(t){e.overlay.find(".theme-wrap").is(":visible")&&(39===t.keyCode&&e.nextTheme(),37===t.keyCode&&e.previousTheme(),27===t.keyCode&&(e.$body.hasClass("modal-open")?e.closeDetails():e.headerContainer.find(".customize-themes-section-title").focus(),t.stopPropagation()))}),e.renderScreenshots=_.throttle(e.renderScreenshots,100),_.bindAll(e,"renderScreenshots","loadMore","checkTerm","filtersChecked")},isContextuallyActive:function(){return this.active()},attachEvents:function(){function e(){var e=i.headerContainer.find(".customize-themes-section-title");e.toggleClass("selected",i.expanded()),e.attr("aria-expanded",i.expanded()?"true":"false"),i.expanded()||e.removeClass("details-open")}var n,i=this;i.container.find(".customize-section-back").on("click keydown",function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),i.collapse())}),i.headerContainer=t("#accordion-section-"+i.id),i.headerContainer.on("click",".customize-themes-section-title",function(){i.headerContainer.find(".filter-details").length&&(i.headerContainer.find(".customize-themes-section-title").toggleClass("details-open").attr("aria-expanded",function(e,t){return"true"===t?"false":"true"}),i.headerContainer.find(".filter-details").slideToggle(180)),i.expanded()||i.expand()}),i.container.on("click",".theme-actions .preview-theme",function(){l.panel("themes").loadThemePreview(t(this).data("slug"))}),i.container.on("click",".theme-prev",function(){i.previousTheme()}),i.container.on("click",".theme-next",function(){i.nextTheme()}),i.container.on("click",".theme-backdrop, .close",function(){i.closeDetails()}),"local"===i.params.filter_type?i.container.on("input",".wp-filter-search-themes",function(e){i.filterSearch(e.currentTarget.value)}):"remote"===i.params.filter_type&&(n=_.debounce(i.checkTerm,500),i.contentContainer.on("input",".wp-filter-search",function(){l.panel("themes").expanded()&&(n(i),i.expanded()||i.expand())}),i.contentContainer.on("click",".filter-group input",function(){i.filtersChecked(),i.checkTerm(i)})),i.contentContainer.on("click",".feature-filter-toggle",function(e){var n=t(".customize-themes-full-container"),a=t(e.currentTarget);if(i.filtersHeight=a.parent().next(".filter-drawer").height(),!(0<n.scrollTop()&&(n.animate({scrollTop:0},400),a.hasClass("open"))))if(a.toggleClass("open").attr("aria-expanded",function(e,t){return"true"===t?"false":"true"}).parent().next(".filter-drawer").slideToggle(180,"linear"),a.hasClass("open")){var o=1018<window.innerWidth?50:76;i.contentContainer.find(".themes").css("margin-top",i.filtersHeight+o)}else i.contentContainer.find(".themes").css("margin-top",0)}),i.contentContainer.on("click",".no-themes-local .search-dotorg-themes",function(){l.section("wporg_themes").focus()}),i.expanded.bind(e),e(),l.bind("ready",function(){i.contentContainer=i.container.find(".customize-themes-section"),i.contentContainer.appendTo(t(".customize-themes-full-container")),i.container.add(i.headerContainer)})},onChangeExpanded:function(e,t){function n(){0===i.loaded&&i.loadThemes(),l.section.each(function(e){var n;e!==i&&"themes"===e.params.type&&(n=e.contentContainer.find(".wp-filter-search").val(),i.contentContainer.find(".wp-filter-search").val(n),""===n&&""!==i.term&&"local"!==i.params.filter_type?(i.term="",i.initializeNewQuery(i.term,i.tags)):"remote"===i.params.filter_type?i.checkTerm(i):"local"===i.params.filter_type&&i.filterSearch(n),e.collapse({duration:t.duration}))}),i.contentContainer.addClass("current-section"),a.scrollTop(),a.on("scroll",_.throttle(i.renderScreenshots,300)),a.on("scroll",_.throttle(i.loadMore,300)),t.completeCallback&&t.completeCallback(),i.updateCount()}var i=this,a=i.contentContainer.closest(".customize-themes-full-container");t.unchanged?t.completeCallback&&t.completeCallback():e?i.panel()&&l.panel.has(i.panel())?l.panel(i.panel()).expand({duration:t.duration,completeCallback:n}):n():(i.contentContainer.removeClass("current-section"),i.headerContainer.find(".filter-details").slideUp(180),a.off("scroll"),t.completeCallback&&t.completeCallback())},getContent:function(){return this.container.find(".control-section-content")},loadThemes:function(){var e,t,n,i=this;i.loading||(t=Math.ceil(i.loaded/100)+1,e={nonce:l.settings.nonce.switch_themes,wp_customize:"on",theme_action:i.params.action,customized_theme:l.settings.theme.stylesheet,page:t},"remote"===i.params.filter_type&&(e.search=i.term,e.tags=i.tags),i.headContainer.closest(".wp-full-overlay").addClass("loading"),i.loading=!0,i.container.find(".no-themes").hide(),n=wp.ajax.post("customize_load_themes",e),n.done(function(e){var n=e.themes;if(""!==i.nextTerm||""!==i.nextTags)return i.nextTerm&&(i.term=i.nextTerm),i.nextTags&&(i.tags=i.nextTags),i.nextTerm="",i.nextTags="",i.loading=!1,void i.loadThemes();0!==n.length?(i.loadControls(n,t),1===t&&(_.each(i.controls().slice(0,3),function(e){var t,n=e.params.theme.screenshot[0];n&&(t=new Image,t.src=n)}),"local"!==i.params.filter_type&&wp.a11y.speak(l.settings.l10n.themeSearchResults.replace("%d",e.info.results))),_.delay(i.renderScreenshots,100),("local"===i.params.filter_type||100>n.length)&&(i.fullyLoaded=!0)):0===i.loaded?(i.container.find(".no-themes").show(),wp.a11y.speak(i.container.find(".no-themes").text())):i.fullyLoaded=!0,"local"===i.params.filter_type?i.updateCount():i.updateCount(e.info.results),i.container.find(".unexpected-error").hide(),i.headContainer.closest(".wp-full-overlay").removeClass("loading"),i.loading=!1}),n.fail(function(e){void 0===e?(i.container.find(".unexpected-error").show(),wp.a11y.speak(i.container.find(".unexpected-error").text())):"undefined"!=typeof console&&console.error&&console.error(e),i.headContainer.closest(".wp-full-overlay").removeClass("loading"),i.loading=!1}))},loadControls:function(e,t){var n=[],i=this;_.each(e,function(e){var t=new l.controlConstructor.theme(i.params.action+"_theme_"+e.id,{type:"theme",section:i.params.id,theme:e,priority:i.loaded+1});l.control.add(t),n.push(t),i.loaded=i.loaded+1}),1!==t&&Array.prototype.push.apply(i.screenshotQueue,n)},loadMore:function(){var e,t,n,i=this;i.fullyLoaded||i.loading||(e=i.container.closest(".customize-themes-full-container"),t=e.scrollTop()+e.height(),n=e.prop("scrollHeight")-3e3,t>n&&i.loadThemes())},filterSearch:function(e){var t,n=0,i=!1,a=this,o=l.section.has("wporg_themes")&&"remote"!==a.params.filter_type?".no-themes-local":".no-themes",s=a.controls();a.loading||(t=e.toLowerCase().trim().replace(/-/g," ").split(" "),_.each(s,function(e){i=e.filter(t),i&&(n+=1)}),0===n?(a.container.find(o).show(),wp.a11y.speak(a.container.find(o).text())):a.container.find(o).hide(),a.renderScreenshots(),l.reflowPaneContents(),a.updateCountDebounced(n))},checkTerm:function(e){var t;"remote"===e.params.filter_type&&(t=e.contentContainer.find(".wp-filter-search").val(),e.term!==t.trim()&&e.initializeNewQuery(t,e.tags))},filtersChecked:function(){var e=this,n=e.container.find(".filter-group").find(":checkbox"),i=[];_.each(n.filter(":checked"),function(e){i.push(t(e).prop("value"))}),0===i.length?(i="",e.contentContainer.find(".feature-filter-toggle .filter-count-0").show(),e.contentContainer.find(".feature-filter-toggle .filter-count-filters").hide()):(e.contentContainer.find(".feature-filter-toggle .theme-filter-count").text(i.length),e.contentContainer.find(".feature-filter-toggle .filter-count-0").hide(),e.contentContainer.find(".feature-filter-toggle .filter-count-filters").show()),_.isEqual(e.tags,i)||(e.loading?e.nextTags=i:"remote"===e.params.filter_type?e.initializeNewQuery(e.term,i):"local"===e.params.filter_type&&e.filterSearch(i.join(" ")))},initializeNewQuery:function(e,t){var n=this;_.each(n.controls(),function(e){e.container.remove(),l.control.remove(e.id)}),n.loaded=0,n.fullyLoaded=!1,n.screenshotQueue=null,n.loading?(n.nextTerm=e,n.nextTags=t):(n.term=e,n.tags=t,n.loadThemes()),n.expanded()||n.expand()},renderScreenshots:function(){var e=this;null!==e.screenshotQueue&&0!==e.screenshotQueue.length||(e.screenshotQueue=_.filter(e.controls(),function(e){return!e.screenshotRendered})),e.screenshotQueue.length&&(e.screenshotQueue=_.filter(e.screenshotQueue,function(t){var n=t.container.find(".theme-screenshot"),i=n.find("img");if(!i.length)return!1;if(i.is(":hidden"))return!0;var a=e.$window.scrollTop(),o=a+e.$window.height(),s=i.offset().top,r=n.height(),c=s+r,l=3*r,d=c>=a-l&&s<=o+l;return d&&t.container.trigger("render-screenshot"),!d}))},getVisibleCount:function(){return this.contentContainer.find("li.customize-control:visible").length},updateCount:function(e){var t,n,i=this;e||0===e||(e=i.getVisibleCount()),n=i.contentContainer.find(".themes-displayed"),t=i.contentContainer.find(".theme-count"),0===e?t.text("0"):(n.fadeOut(180,function(){t.text(e),n.fadeIn(180)}),wp.a11y.speak(l.settings.l10n.announceThemeCount.replace("%d",e)))},nextTheme:function(){var e=this;e.getNextTheme()&&e.showDetails(e.getNextTheme(),function(){e.overlay.find(".right").focus()})},getNextTheme:function(){var e,t,n,i,a=this;return e=l.control(a.params.action+"_theme_"+a.currentTheme),n=a.controls(),i=_.indexOf(n,e),-1!==i&&(t=n[i+1],!!t&&t.params.theme)},previousTheme:function(){var e=this;e.getPreviousTheme()&&e.showDetails(e.getPreviousTheme(),function(){e.overlay.find(".left").focus()})},getPreviousTheme:function(){var e,t,n,i,a=this;return e=l.control(a.params.action+"_theme_"+a.currentTheme),n=a.controls(),i=_.indexOf(n,e),-1!==i&&(t=n[i-1],!!t&&t.params.theme)},updateLimits:function(){this.getNextTheme()||this.overlay.find(".right").addClass("disabled"),this.getPreviousTheme()||this.overlay.find(".left").addClass("disabled")},loadThemePreview:function(e){return l.ThemesPanel.prototype.loadThemePreview.call(this,e)},showDetails:function(e,t){function n(){return!o.canSwitchTheme(e.id)}function i(){return n()||!1===l.settings.theme._canInstall||!0===l.settings.theme._filesystemCredentialsNeeded}var a=this,o=l.panel("themes");a.currentTheme=e.id,a.overlay.html(a.template(e)).fadeIn("fast").focus(),a.overlay.find("button.preview, button.preview-theme").toggleClass("disabled",n()),a.overlay.find("button.theme-install").toggleClass("disabled",i()),a.$body.addClass("modal-open"),a.containFocus(a.overlay),a.updateLimits(),wp.a11y.speak(l.settings.l10n.announceThemeDetails.replace("%s",e.name)),t&&t()},closeDetails:function(){var e=this;e.$body.removeClass("modal-open"),e.overlay.fadeOut("fast"),l.control(e.params.action+"_theme_"+e.currentTheme).container.find(".theme").focus()},containFocus:function(e){var n;e.on("keydown",function(i){if(9===i.keyCode)return n=t(":tabbable",e),n.last()[0]!==i.target||i.shiftKey?n.first()[0]===i.target&&i.shiftKey?(n.last().focus(),!1):void 0:(n.first().focus(),!1)})}}),l.OuterSection=l.Section.extend({initialize:function(){var e=this;e.containerParent="#customize-outer-theme-controls",e.containerPaneParent=".customize-outer-pane-parent",l.Section.prototype.initialize.apply(e,arguments)},onChangeExpanded:function(e,n){var i,a,o=this,s=o.headContainer.closest(".wp-full-overlay-sidebar-content"),r=o.contentContainer,c=r.find(".customize-section-back"),d=o.headContainer.find(".accordion-section-title").first(),u=t(document.body);u.toggleClass("outer-section-open",e),o.container.toggleClass("open",e),o.container.removeClass("busy"),l.section.each(function(e){"outer"===e.params.type&&e.id!==o.id&&e.container.removeClass("open")}),e&&!r.hasClass("open")?(i=n.unchanged?n.completeCallback:t.proxy(function(){o._animateChangeExpanded(function(){d.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),r.css("top",""),s.scrollTop(0),n.completeCallback&&n.completeCallback()}),r.addClass("open")},this),o.panel()?l.panel(o.panel()).expand({duration:n.duration,completeCallback:i}):i()):!e&&r.hasClass("open")?(o.panel()&&(a=l.panel(o.panel()),a.contentContainer.hasClass("skip-transition")&&a.collapse()),o._animateChangeExpanded(function(){c.attr("tabindex","-1"),d.attr("tabindex","0"),d.focus(),r.css("top",""),n.completeCallback&&n.completeCallback()}),r.removeClass("open")):n.completeCallback&&n.completeCallback()}}),l.Panel=n.extend({containerType:"panel",initialize:function(e,t){var i,a=this;i=t.params||t,i.type||_.find(l.panelConstructor,function(e,t){return e===a.constructor&&(i.type=t,!0)}),n.prototype.initialize.call(a,e,i),a.embed(),a.deferred.embedded.done(function(){a.ready()})},embed:function(){var e=this,n=t("#customize-theme-controls"),i=t(".customize-pane-parent");e.headContainer.parent().is(i)||i.append(e.headContainer),e.contentContainer.parent().is(e.headContainer)||n.append(e.contentContainer),e.renderContent(),e.deferred.embedded.resolve()},attachEvents:function(){var e,n=this;n.headContainer.find(".accordion-section-title").on("click keydown",function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),n.expanded()||n.expand())}),n.container.find(".customize-panel-back").on("click keydown",function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),n.expanded()&&n.collapse())}),e=n.container.find(".panel-meta:first"),e.find("> .accordion-section-title .customize-help-toggle").on("click",function(){if(!e.hasClass("cannot-expand")){var i=e.find(".customize-panel-description:first");e.hasClass("open")?(e.toggleClass("open"),i.slideUp(n.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),t(this).attr("aria-expanded",!1)):(i.slideDown(n.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),e.toggleClass("open"),t(this).attr("aria-expanded",!0))}})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var e=this,t=e.sections(),n=0;return _(t).each(function(e){e.active()&&e.isContextuallyActive()&&(n+=1)}),0!==n},onChangeExpanded:function(e,t){if(t.unchanged)t.completeCallback&&t.completeCallback();else{var n,i=this,a=i.contentContainer,o=a.closest(".wp-full-overlay"),s=a.closest(".wp-full-overlay-sidebar-content"),r=i.headContainer.find(".accordion-section-title"),c=a.find(".customize-panel-back"),d=i.sections();e&&!a.hasClass("current-panel")?(l.section.each(function(e){i.id!==e.panel()&&e.collapse({duration:0})}),l.panel.each(function(e){i!==e&&e.collapse({duration:0})}),
i.params.autoExpandSoleSection&&1===d.length&&d[0].active.get()?(a.addClass("current-panel skip-transition"),o.addClass("in-sub-panel"),d[0].expand({completeCallback:t.completeCallback})):(i._animateChangeExpanded(function(){r.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),a.css("top",""),s.scrollTop(0),t.completeCallback&&t.completeCallback()}),a.addClass("current-panel"),o.addClass("in-sub-panel")),l.state("expandedPanel").set(i)):!e&&a.hasClass("current-panel")&&(n=a.hasClass("skip-transition"),n?a.removeClass("skip-transition"):i._animateChangeExpanded(function(){r.attr("tabindex","0"),c.attr("tabindex","-1"),r.focus(),a.css("top",""),t.completeCallback&&t.completeCallback()}),o.removeClass("in-sub-panel"),a.removeClass("current-panel"),i===l.state("expandedPanel").get()&&l.state("expandedPanel").set(!1))}},renderContent:function(){var e,n=this;e=0!==t("#tmpl-"+n.templateSelector+"-content").length?wp.template(n.templateSelector+"-content"):wp.template("customize-panel-default-content"),e&&n.headContainer&&n.contentContainer.html(e(_.extend({id:n.id},n.params)))}}),l.ThemesPanel=l.Panel.extend({initialize:function(e,t){var n=this;n.installingThemes=[],l.Panel.prototype.initialize.call(n,e,t)},canSwitchTheme:function(e){return!(!e||e!==l.settings.theme.stylesheet)||"publish"===l.state("selectedChangesetStatus").get()&&(""===l.state("changesetStatus").get()||"auto-draft"===l.state("changesetStatus").get())},attachEvents:function(){function e(){n.canSwitchTheme()?n.notifications.remove("theme_switch_unavailable"):n.notifications.add(new l.Notification("theme_switch_unavailable",{message:l.l10n.themePreviewUnavailable,type:"warning"}))}var n=this;l.Panel.prototype.attachEvents.apply(n),l.settings.theme._canInstall&&l.settings.theme._filesystemCredentialsNeeded&&n.notifications.add(new l.Notification("theme_install_unavailable",{message:l.l10n.themeInstallUnavailable,type:"info",dismissible:!0})),e(),l.state("selectedChangesetStatus").bind(e),l.state("changesetStatus").bind(e),n.contentContainer.on("click",".customize-theme",function(){n.collapse()}),n.contentContainer.on("click",".customize-themes-section-title, .customize-themes-mobile-back",function(){t(".wp-full-overlay").toggleClass("showing-themes")}),n.contentContainer.on("click",".theme-install",function(e){n.installTheme(e)}),n.contentContainer.on("click",".update-theme, #update-theme",function(e){e.preventDefault(),e.stopPropagation(),n.updateTheme(e)}),n.contentContainer.on("click",".delete-theme",function(e){n.deleteTheme(e)}),_.bindAll(n,"installTheme","updateTheme")},onChangeExpanded:function(e,t){var n,i,a=this,o=!1;l.Panel.prototype.onChangeExpanded.apply(this,[e,t]),t.unchanged?t.completeCallback&&t.completeCallback():(n=a.headContainer.closest(".wp-full-overlay"),e?(n.addClass("in-themes-panel").delay(200).find(".customize-themes-full-container").addClass("animate"),_.delay(function(){n.addClass("themes-panel-expanded")},200),600<window.innerWidth&&(i=a.sections(),_.each(i,function(e){e.expanded()&&(o=!0)}),!o&&i.length>0&&i[0].expand())):n.removeClass("in-themes-panel themes-panel-expanded").find(".customize-themes-full-container").removeClass("animate"))},installTheme:function(e){var n,i,a,o=this,s=t(e.target).data("slug"),r=t.Deferred();return n=t(e.target).hasClass("preview"),l.settings.theme._filesystemCredentialsNeeded?(r.reject({errorCode:"theme_install_unavailable"}),r.promise()):o.canSwitchTheme(s)?_.contains(o.installingThemes,s)?(r.reject({errorCode:"theme_already_installing"}),r.promise()):(wp.updates.maybeRequestFilesystemCredentials(e),i=function(e){var t,i=!1;if(n)l.notifications.remove("theme_installing"),o.loadThemePreview(s);else{if(l.control.each(function(t){"theme"===t.params.type&&t.params.theme.id===e.slug&&(i=t.params.theme,t.rerenderAsInstalled(!0))}),!i||l.control.has("installed_theme_"+i.id))return void r.resolve(e);i.type="installed",t=new l.controlConstructor.theme("installed_theme_"+i.id,{type:"theme",section:"installed_themes",theme:i,priority:0}),l.control.add(t),l.control(t.id).container.trigger("render-screenshot"),l.section.each(function(e){"themes"===e.params.type&&i.id===e.currentTheme&&e.closeDetails()})}r.resolve(e)},o.installingThemes.push(s),a=wp.updates.installTheme({slug:s}),n&&l.notifications.add(new l.OverlayNotification("theme_installing",{message:l.l10n.themeDownloading,type:"info",loading:!0})),a.done(i),a.fail(function(){l.notifications.remove("theme_installing")}),r.promise()):(r.reject({errorCode:"theme_switch_unavailable"}),r.promise())},loadThemePreview:function(e){var n,i,a,o=this,s=t.Deferred();return o.canSwitchTheme(e)?(i=document.createElement("a"),i.href=location.href,a=_.extend(l.utils.parseQueryString(i.search.substr(1)),{theme:e,changeset_uuid:l.settings.changeset.uuid,return:l.settings.url.return}),l.state("saved").get()||(a.customize_autosaved="on"),i.search=t.param(a),l.notifications.add(new l.OverlayNotification("theme_previewing",{message:l.l10n.themePreviewWait,type:"info",loading:!0})),n=function(){var e;l.state("processing").get()>0||(l.state("processing").unbind(n),e=l.requestChangesetUpdate({},{autosave:!0}),e.done(function(){s.resolve(),t(window).off("beforeunload.customize-confirm"),location.replace(i.href)}),e.fail(function(){l.notifications.remove("theme_previewing"),s.reject()}))},0===l.state("processing").get()?n():l.state("processing").bind(n),s.promise()):(s.reject({errorCode:"theme_switch_unavailable"}),s.promise())},updateTheme:function(e){wp.updates.maybeRequestFilesystemCredentials(e),t(document).one("wp-theme-update-success",function(e,t){l.control.each(function(e){"theme"===e.params.type&&e.params.theme.id===t.slug&&(e.params.theme.hasUpdate=!1,e.params.theme.version=t.newVersion,setTimeout(function(){e.rerenderAsInstalled(!0)},2e3))})}),wp.updates.updateTheme({slug:t(e.target).closest(".notice").data("slug")})},deleteTheme:function(e){var n,i;n=t(e.target).data("slug"),i=l.section("installed_themes"),e.preventDefault(),l.settings.theme._filesystemCredentialsNeeded||window.confirm(l.settings.l10n.confirmDeleteTheme)&&(wp.updates.maybeRequestFilesystemCredentials(e),t(document).one("wp-theme-delete-success",function(){var e=l.control("installed_theme_"+n);e.container.remove(),l.control.remove(e.id),i.loaded=i.loaded-1,i.updateCount(),l.control.each(function(e){"theme"===e.params.type&&e.params.theme.id===n&&e.rerenderAsInstalled(!1)})}),wp.updates.deleteTheme({slug:n}),i.closeDetails(),i.focus())}}),l.Control=l.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:t.noop},defaults:{label:"",description:"",active:!0,priority:10},initialize:function(e,n){var i,a,o=this,s=[];o.params=_.extend({},o.defaults,o.params||{},n.params||n||{}),l.Control.instanceCounter||(l.Control.instanceCounter=0),l.Control.instanceCounter++,o.params.instanceNumber||(o.params.instanceNumber=l.Control.instanceCounter),o.params.type||_.find(l.controlConstructor,function(e,t){return e===o.constructor&&(o.params.type=t,!0)}),o.params.content||("theme"===o.params.type?classAttr="customize-control theme customize-control-"+o.params.type:classAttr="customize-control customize-control-"+o.params.type,o.params.content=t("<li></li>",{id:"customize-control-"+e.replace(/]/g,"").replace(/\[/g,"-"),class:classAttr})),o.id=e,o.selector="#customize-control-"+e.replace(/\]/g,"").replace(/\[/g,"-"),o.params.content?o.container=t(o.params.content):o.container=t(o.selector),o.params.templateId?o.templateSelector=o.params.templateId:o.templateSelector="customize-control-"+o.params.type+"-content",o.deferred=_.extend(o.deferred||{},{embedded:new t.Deferred}),o.section=new l.Value,o.priority=new l.Value,o.active=new l.Value,o.activeArgumentsQueue=[],o.notifications=new l.Notifications({alt:o.altNotice}),o.elements=[],o.active.bind(function(e){var n=o.activeArgumentsQueue.shift();n=t.extend({},o.defaultActiveArguments,n),o.onChangeActive(e,n)}),o.section.set(o.params.section),o.priority.set(isNaN(o.params.priority)?10:o.params.priority),o.active.set(o.params.active),l.utils.bubbleChildValueChanges(o,["section","priority","active"]),o.settings={},i={},o.params.setting&&(i.default=o.params.setting),_.extend(i,o.params.settings),_.each(i,function(e,t){var n;_.isObject(e)&&_.isFunction(e.extended)&&e.extended(l.Value)?o.settings[t]=e:_.isString(e)&&(n=l(e),n?o.settings[t]=n:s.push(e))}),a=function(){_.each(i,function(e,t){!o.settings[t]&&_.isString(e)&&(o.settings[t]=l(e))}),o.settings[0]&&!o.settings.default&&(o.settings.default=o.settings[0]),o.setting=o.settings.default||null,o.linkElements(),o.embed()},0===s.length?a():l.apply(l,s.concat(a)),o.deferred.embedded.done(function(){o.linkElements(),o.setupNotifications(),o.ready()})},linkElements:function(){var e,n,i,a=this;e=a.container.find("[data-customize-setting-link], [data-customize-setting-key-link]"),n={},e.each(function(){var o,s,r=t(this);if(!r.data("customizeSettingLinked")){if(r.data("customizeSettingLinked",!0),r.is(":radio")){if(o=r.prop("name"),n[o])return;n[o]=!0,r=e.filter('[name="'+o+'"]')}r.data("customizeSettingLink")?s=l(r.data("customizeSettingLink")):r.data("customizeSettingKeyLink")&&(s=a.settings[r.data("customizeSettingKeyLink")]),s&&(i=new l.Element(r),a.elements.push(i),i.sync(s),i.set(s()))}})},embed:function(){var e,t=this;e=function(e){var n;e&&l.section(e,function(e){e.deferred.embedded.done(function(){n=e.contentContainer.is("ul")?e.contentContainer:e.contentContainer.find("ul:first"),t.container.parent().is(n)||(n.append(t.container),t.renderContent()),t.deferred.embedded.resolve()})})},t.section.bind(e),e(t.section.get())},ready:function(){var e,n=this;"dropdown-pages"===n.params.type&&n.params.allow_addition&&(e=n.container.find(".new-content-item"),e.hide(),n.container.on("click",".add-new-toggle",function(n){t(n.currentTarget).slideUp(180),e.slideDown(180),e.find(".create-item-input").focus()}),n.container.on("click",".add-content",function(){n.addNewPage()}),n.container.on("keydown",".create-item-input",function(e){13===e.which&&n.addNewPage()}))},getNotificationsContainerElement:function(){var e,n,i=this;return n=i.container.find(".customize-control-notifications-container:first"),n.length?n:(n=t('<div class="customize-control-notifications-container"></div>'),i.container.hasClass("customize-control-nav_menu_item")?i.container.find(".menu-item-settings:first").prepend(n):i.container.hasClass("customize-control-widget_form")?i.container.find(".widget-inside:first").prepend(n):(e=i.container.find(".customize-control-title"),e.length?e.after(n):i.container.prepend(n)),n)},setupNotifications:function(){var e,t,n=this;_.each(n.settings,function(e){e.notifications&&(e.notifications.bind("add",function(t){var i=_.extend({},t,{setting:e.id});n.notifications.add(new l.Notification(e.id+":"+t.code,i))}),e.notifications.bind("remove",function(t){n.notifications.remove(e.id+":"+t.code)}))}),e=function(){var e=n.section();(!e||l.section.has(e)&&l.section(e).expanded())&&n.notifications.render()},n.notifications.bind("rendered",function(){var e=n.notifications.get();n.container.toggleClass("has-notifications",0!==e.length),n.container.toggleClass("has-error",0!==_.where(e,{type:"error"}).length)}),t=function(t,n){n&&l.section.has(n)&&l.section(n).expanded.unbind(e),t&&l.section(t,function(t){t.expanded.bind(e),e()})},n.section.bind(t),t(n.section.get()),n.notifications.bind("change",_.debounce(e))},renderNotifications:function(){var e,n,i=this,a=!1;"undefined"!=typeof console&&console.warn&&console.warn("[DEPRECATED] wp.customize.Control.prototype.renderNotifications() is deprecated in favor of instantating a wp.customize.Notifications and calling its render() method."),e=i.getNotificationsContainerElement(),e&&e.length&&(n=[],i.notifications.each(function(e){n.push(e),"error"===e.type&&(a=!0)}),0===n.length?e.stop().slideUp("fast"):e.stop().slideDown("fast",null,function(){t(this).css("height","auto")}),i.notificationsTemplate||(i.notificationsTemplate=wp.template("customize-control-notifications")),i.container.toggleClass("has-notifications",0!==n.length),i.container.toggleClass("has-error",a),e.empty().append(t.trim(i.notificationsTemplate({notifications:n,altNotice:Boolean(i.altNotice)}))))},expand:function(e){l.section(this.section()).expand(e)},focus:i,onChangeActive:function(e,n){n.unchanged?n.completeCallback&&n.completeCallback():t.contains(document,this.container[0])?e?this.container.slideDown(n.duration,n.completeCallback):this.container.slideUp(n.duration,n.completeCallback):(this.container.toggle(e),n.completeCallback&&n.completeCallback())},toggle:function(e){return this.onChangeActive(e,this.defaultActiveArguments)},activate:n.prototype.activate,deactivate:n.prototype.deactivate,_toggleActive:n.prototype._toggleActive,dropdownInit:function(){var e=this,t=this.container.find(".dropdown-status"),n=this.params,i=!1,a=function(e){"string"==typeof e&&n.statuses&&n.statuses[e]?t.html(n.statuses[e]).show():t.hide()};this.container.on("click keydown",".dropdown",function(t){l.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),i||e.container.toggleClass("open"),e.container.hasClass("open")&&e.container.parent().parent().find("li.library-selected").focus(),i=!0,setTimeout(function(){i=!1},400))}),this.setting.bind(a),a(this.setting())},renderContent:function(){var e,t,n,i,a=this;t=["button","checkbox","date","datetime-local","email","month","number","password","radio","range","search","select","tel","time","text","textarea","week","url"],n=a.templateSelector,n==="customize-control-"+a.params.type+"-content"&&_.contains(t,a.params.type)&&!document.getElementById("tmpl-"+n)&&0===a.container.children().length&&(n="customize-control-default-content"),document.getElementById("tmpl-"+n)&&(e=wp.template(n),e&&a.container&&a.container.html(e(a.params))),a.notifications.container=a.getNotificationsContainerElement(),i=a.section(),(!i||l.section.has(i)&&l.section(i).expanded())&&a.notifications.render()},addNewPage:function(){var e,n,i,a,o,s,r=this;"dropdown-pages"===r.params.type&&r.params.allow_addition&&l.Menus&&(n=r.container.find(".add-new-toggle"),i=r.container.find(".new-content-item"),a=r.container.find(".create-item-input"),o=a.val(),s=r.container.find("select"),o?(a.removeClass("invalid"),a.attr("disabled","disabled"),e=l.Menus.insertAutoDraftPost({post_title:o,post_type:"page"}),e.done(function(e){var a,c,d;a=new l.Menus.AvailableItemModel({id:"post-"+e.post_id,title:o,type:"post_type",type_label:l.Menus.data.l10n.page_label,object:"page",object_id:e.post_id,url:e.url}),l.Menus.availableMenuItemsPanel.collection.add(a),c=t("#available-menu-items-post_type-page").find(".available-menu-items-list"),d=wp.template("available-menu-item"),c.prepend(d(a.attributes)),s.focus(),r.setting.set(String(e.post_id)),i.slideUp(180),n.slideDown(180)}),e.always(function(){a.val("").removeAttr("disabled")})):a.addClass("invalid"))}}),l.ColorControl=l.Control.extend({ready:function(){var e,t=this,n="hue"===this.params.mode,i=!1;n?(e=this.container.find(".color-picker-hue"),e.val(t.setting()).wpColorPicker({change:function(e,n){i=!0,t.setting(n.color.h()),i=!1}})):(e=this.container.find(".color-picker-hex"),e.val(t.setting()).wpColorPicker({change:function(){i=!0,t.setting.set(e.wpColorPicker("color")),i=!1},clear:function(){i=!0,t.setting.set(""),i=!1}})),t.setting.bind(function(t){i||(e.val(t),e.wpColorPicker("color",t))}),t.container.on("keydown",function(n){var i;27===n.which&&(i=t.container.find(".wp-picker-container"),i.hasClass("wp-picker-active")&&(e.wpColorPicker("close"),t.container.find(".wp-color-result").focus(),n.stopPropagation()))})}}),l.MediaControl=l.Control.extend({ready:function(){function e(e){var i=t.Deferred();n.extended(l.UploadControl)?i.resolve():(e=parseInt(e,10),_.isNaN(e)||e<=0?(delete n.params.attachment,i.resolve()):n.params.attachment&&n.params.attachment.id===e&&i.resolve()),"pending"===i.state()&&wp.media.attachment(e).fetch().done(function(){n.params.attachment=this.attributes,i.resolve(),wp.customize.previewer.send(n.setting.id+"-attachment-data",this.attributes)}),i.done(function(){n.renderContent()})}var n=this;_.bindAll(n,"restoreDefault","removeFile","openFrame","select","pausePlayer"),n.container.on("click keydown",".upload-button",n.openFrame),n.container.on("click keydown",".upload-button",n.pausePlayer),n.container.on("click keydown",".thumbnail-image img",n.openFrame),n.container.on("click keydown",".default-button",n.restoreDefault),n.container.on("click keydown",".remove-button",n.pausePlayer),n.container.on("click keydown",".remove-button",n.removeFile),n.container.on("click keydown",".remove-button",n.cleanupPlayer),l.section(n.section()).container.on("expanded",function(){n.player&&n.player.setControlsSize()}).on("collapsed",function(){n.pausePlayer()}),e(n.setting()),n.setting.bind(e)},pausePlayer:function(){this.player&&this.player.pause()},cleanupPlayer:function(){this.player&&wp.media.mixin.removePlayer(this.player)},openFrame:function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var e,t=this.frame.state().get("selection").first().toJSON(),n=window._wpmejsSettings||{};this.params.attachment=t,this.setting(t.id),e=this.container.find("audio, video").get(0),e?this.player=new MediaElementPlayer(e,n):this.cleanupPlayer()},restoreDefault:function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment=this.params.defaultAttachment,this.setting(this.params.defaultAttachment.url))},removeFile:function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent())}}),l.UploadControl=l.MediaControl.extend({select:function(){var e,t=this.frame.state().get("selection").first().toJSON(),n=window._wpmejsSettings||{};this.params.attachment=t,this.setting(t.url),e=this.container.find("audio, video").get(0),e?this.player=new MediaElementPlayer(e,n):this.cleanupPlayer()},success:function(){},removerVisibility:function(){}}),l.ImageControl=l.UploadControl.extend({thumbnailSrc:function(){}}),l.BackgroundControl=l.UploadControl.extend({ready:function(){l.UploadControl.prototype.ready.apply(this,arguments)},select:function(){l.UploadControl.prototype.select.apply(this,arguments),wp.ajax.post("custom-background-add",{nonce:_wpCustomizeBackground.nonces.add,wp_customize:"on",customize_theme:l.settings.theme.stylesheet,attachment_id:this.params.attachment.id})}}),l.BackgroundPositionControl=l.Control.extend({ready:function(){var e,n=this;n.container.on("change",'input[name="background-position"]',function(){var e=t(this).val().split(" ");n.settings.x(e[0]),n.settings.y(e[1])}),e=_.debounce(function(){var e,t,i,a;e=n.settings.x.get(),t=n.settings.y.get(),a=String(e)+" "+String(t),i=n.container.find('input[name="background-position"][value="'+a+'"]'),i.click()}),n.settings.x.bind(e),n.settings.y.bind(e),e()}}),l.CroppedImageControl=l.MediaControl.extend({openFrame:function(e){l.utils.isKeydownButNotEnterEvent(e)||(this.initFrame(),this.frame.setState("library").open())},initFrame:function(){var e=_wpMediaViewsL10n;this.frame=wp.media({button:{text:e.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var e=this.frame.state().get("selection").first().toJSON();this.params.width!==e.width||this.params.height!==e.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):(this.setImageFromAttachment(e),this.frame.close())},onCropped:function(e){this.setImageFromAttachment(e)},calculateImageSelectOptions:function(e,t){var n,i,a,o=t.get("control"),s=!!parseInt(o.params.flex_width,10),r=!!parseInt(o.params.flex_height,10),c=e.get("width"),l=e.get("height"),d=parseInt(o.params.width,10),u=parseInt(o.params.height,10),p=d/u,h=d,f=u;return t.set("canSkipCrop",!o.mustBeCropped(s,r,d,u,c,l)),c/l>p?(u=l,d=u*p):(d=c,u=d/p),n=(c-d)/2,i=(l-u)/2,a={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:c,imageHeight:l,minWidth:h>d?d:h,minHeight:f>u?u:f,x1:n,y1:i,x2:d+n,y2:u+i},!1===r&&!1===s&&(a.aspectRatio=d+":"+u),!0===r&&(delete a.minHeight,a.maxWidth=c),!0===s&&(delete a.minWidth,a.maxHeight=l),a},mustBeCropped:function(e,t,n,i,a,o){return(!0!==e||!0!==t)&&((!0!==e||i!==o)&&((!0!==t||n!==a)&&((n!==a||i!==o)&&!(a<=n))))},onSkippedCrop:function(){var e=this.frame.state().get("selection").first().toJSON();this.setImageFromAttachment(e)},setImageFromAttachment:function(e){this.params.attachment=e,this.setting(e.id)}}),l.SiteIconControl=l.CroppedImageControl.extend({initFrame:function(){var e=_wpMediaViewsL10n;this.frame=wp.media({button:{text:e.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.SiteIconCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var e=this.frame.state().get("selection").first().toJSON(),t=this;this.params.width!==e.width||this.params.height!==e.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):wp.ajax.post("crop-image",{nonce:e.nonces.edit,id:e.id,context:"site-icon",cropDetails:{x1:0,y1:0,width:this.params.width,height:this.params.height,dst_width:this.params.width,dst_height:this.params.height}}).done(function(e){t.setImageFromAttachment(e),t.frame.close()}).fail(function(){t.frame.trigger("content:error:crop")})},setImageFromAttachment:function(e){var n,i,a=["site_icon-32","thumbnail","full"];_.each(a,function(t){i||_.isUndefined(e.sizes[t])||(i=e.sizes[t])}),this.params.attachment=e,this.setting(e.id),i&&(n=t('link[rel="icon"][sizes="32x32"]'),n.attr("href",i.url))},removeFile:function(e){l.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent(),t('link[rel="icon"][sizes="32x32"]').attr("href","/favicon.ico"))}}),l.HeaderControl=l.Control.extend({ready:function(){this.btnRemove=t("#customize-control-header_image .actions .remove"),this.btnNew=t("#customize-control-header_image .actions .new"),_.bindAll(this,"openMedia","removeImage"),this.btnNew.on("click",this.openMedia),this.btnRemove.on("click",this.removeImage),l.HeaderTool.currentHeader=this.getInitialHeaderImage(),new l.HeaderTool.CurrentView({model:l.HeaderTool.currentHeader,el:"#customize-control-header_image .current .container"}),new l.HeaderTool.ChoiceListView({collection:l.HeaderTool.UploadsList=new l.HeaderTool.ChoiceList,el:"#customize-control-header_image .choices .uploaded .list"}),new l.HeaderTool.ChoiceListView({collection:l.HeaderTool.DefaultsList=new l.HeaderTool.DefaultsList,el:"#customize-control-header_image .choices .default .list"}),l.HeaderTool.combinedList=l.HeaderTool.CombinedList=new l.HeaderTool.CombinedList([l.HeaderTool.UploadsList,l.HeaderTool.DefaultsList]),wp.media.controller.Cropper.prototype.defaults.doCropArgs.wp_customize="on",wp.media.controller.Cropper.prototype.defaults.doCropArgs.customize_theme=l.settings.theme.stylesheet},getInitialHeaderImage:function(){if(!l.get().header_image||!l.get().header_image_data||_.contains(["remove-header","random-default-image","random-uploaded-image"],l.get().header_image))return new l.HeaderTool.ImageModel;var e=_.find(_wpCustomizeHeader.uploads,function(e){return e.attachment_id===l.get().header_image_data.attachment_id});return e||(e={url:l.get().header_image,thumbnail_url:l.get().header_image,attachment_id:l.get().header_image_data.attachment_id}),new l.HeaderTool.ImageModel({header:e,choice:e.url.split("/").pop()})},calculateImageSelectOptions:function(e,t){var n,i,a,o,s,r,c=parseInt(_wpCustomizeHeader.data.width,10),d=parseInt(_wpCustomizeHeader.data.height,10),u=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),p=!!parseInt(_wpCustomizeHeader.data["flex-height"],10);return s=e.get("width"),o=e.get("height"),this.headerImage=new l.HeaderTool.ImageModel,this.headerImage.set({themeWidth:c,themeHeight:d,themeFlexWidth:u,themeFlexHeight:p,imageWidth:s,imageHeight:o}),t.set("canSkipCrop",!this.headerImage.shouldBeCropped()),n=c/d,i=s,a=o,i/a>n?(d=a,c=d*n):(c=i,d=c/n),r={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:s,imageHeight:o,x1:0,y1:0,x2:c,y2:d},!1===p&&!1===u&&(r.aspectRatio=c+":"+d),!1===p&&(r.maxHeight=d),!1===u&&(r.maxWidth=c),r},openMedia:function(e){var t=_wpMediaViewsL10n;e.preventDefault(),this.frame=wp.media({button:{text:t.selectAndCrop,close:!1},states:[new wp.media.controller.Library({title:t.chooseImage,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this),this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(e){var t=e.url,n=e.attachment_id,i=e.width,a=e.height;this.setImageFromURL(t,n,i,a)},onSkippedCrop:function(e){var t=e.get("url"),n=e.get("width"),i=e.get("height");this.setImageFromURL(t,e.id,n,i)},setImageFromURL:function(e,t,n,i){var a,o={};o.url=e,o.thumbnail_url=e,o.timestamp=_.now(),t&&(o.attachment_id=t),n&&(o.width=n),i&&(o.height=i),a=new l.HeaderTool.ImageModel({header:o,choice:e.split("/").pop()}),l.HeaderTool.UploadsList.add(a),l.HeaderTool.currentHeader.set(a.toJSON()),a.save(),a.importImage()},removeImage:function(){l.HeaderTool.currentHeader.trigger("hide"),l.HeaderTool.CombinedList.trigger("control:removeImage")}}),l.ThemeControl=l.Control.extend({touchDrag:!1,screenshotRendered:!1,ready:function(){function e(){return!o.canSwitchTheme(a.params.theme.id)}function n(){return e()||!1===l.settings.theme._canInstall||!0===l.settings.theme._filesystemCredentialsNeeded}function i(){a.container.find("button.preview, button.preview-theme").toggleClass("disabled",e()),a.container.find("button.theme-install").toggleClass("disabled",n())}var a=this,o=l.panel("themes");l.state("selectedChangesetStatus").bind(i),l.state("changesetStatus").bind(i),i(),a.container.on("touchmove",".theme",function(){a.touchDrag=!0}),a.container.on("click keydown touchend",".theme",function(e){var n;if(!l.utils.isKeydownButNotEnterEvent(e))return!0===a.touchDrag?a.touchDrag=!1:void(t(e.target).is(".theme-actions .button, .update-theme")||(e.preventDefault(),n=l.section(a.section()),n.showDetails(a.params.theme,function(){l.settings.theme._filesystemCredentialsNeeded&&n.overlay.find(".theme-actions .delete-theme").remove()})))}),a.container.on("render-screenshot",function(){var e=t(this).find("img"),n=e.data("src");n&&e.attr("src",n),a.screenshotRendered=!0})},filter:function(e){var t=this,n=0,i=t.params.theme.name+" "+t.params.theme.description+" "+t.params.theme.tags+" "+t.params.theme.author+" ";return i=i.toLowerCase().replace("-"," "),_.isArray(e)||(e=[e]),t.params.theme.name.toLowerCase()===e.join(" ")?n=100:(n+=10*(i.split(e.join(" ")).length-1),_.each(e,function(e){n+=2*(i.split(e+" ").length-1),n=n+i.split(e).length-1}),n>99&&(n=99)),0!==n?(t.activate(),t.params.priority=101-n,!0):(t.deactivate(),t.params.priority=101,!1)},rerenderAsInstalled:function(e){var t,n=this;e?n.params.theme.type="installed":(t=l.section(n.params.section),n.params.theme.type=t.params.action),n.renderContent(),n.container.trigger("render-screenshot")}}),l.CodeEditorControl=l.Control.extend({initialize:function(e,n){var i=this;i.deferred=_.extend(i.deferred||{},{codemirror:t.Deferred()}),l.Control.prototype.initialize.call(i,e,n),i.notifications.bind("add",function(e){var t;e.code===i.setting.id+":csslint_error"&&(e.templateId="customize-code-editor-lint-error-notification",e.render=(t=e.render,function(){var e=t.call(this);return e.find("input[type=checkbox]").on("click",function(){i.setting.notifications.remove("csslint_error")}),e}))})},ready:function(){var e=this;e.section()?l.section(e.section(),function(t){t.deferred.embedded.done(function(){var n;t.expanded()?e.initEditor():(n=function(i){i&&(e.initEditor(),t.expanded.unbind(n))},t.expanded.bind(n))})}):e.initEditor()},initEditor:function(){var e,t=this,n=!1;wp.codeEditor&&(_.isUndefined(t.params.editor_settings)||!1!==t.params.editor_settings)&&(n=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{},n.codemirror=_.extend({},n.codemirror,{indentUnit:2,tabSize:2}),_.isObject(t.params.editor_settings)&&_.each(t.params.editor_settings,function(e,t){_.isObject(e)&&(n[t]=_.extend({},n[t],e))})),e=new l.Element(t.container.find("textarea")),t.elements.push(e),e.sync(t.setting),e.set(t.setting()),n?t.initSyntaxHighlightingEditor(n):t.initPlainTextareaEditor()},focus:function(e){var t,n=this,i=_.extend({},e);t=i.completeCallback,i.completeCallback=function(){t&&t(),n.editor&&n.editor.codemirror.focus()},l.Control.prototype.focus.call(n,i)},initSyntaxHighlightingEditor:function(e){var n,i=this,a=i.container.find("textarea"),o=!1;n=_.extend({},e,{onTabNext:_.bind(i.onTabNext,i),onTabPrevious:_.bind(i.onTabPrevious,i),onUpdateErrorNotice:_.bind(i.onUpdateErrorNotice,i)}),i.editor=wp.codeEditor.initialize(a,n),t(i.editor.codemirror.display.lineDiv).attr({role:"textbox","aria-multiline":"true","aria-label":i.params.label,"aria-describedby":"editor-keyboard-trap-help-1 editor-keyboard-trap-help-2 editor-keyboard-trap-help-3 editor-keyboard-trap-help-4"}),i.container.find("label").on("click",function(){i.editor.codemirror.focus()}),i.editor.codemirror.on("change",function(e){o=!0,a.val(e.getValue()).trigger("change"),o=!1}),i.setting.bind(function(e){o||i.editor.codemirror.setValue(e)}),i.editor.codemirror.on("keydown",function(e,t){var n=27;n===t.keyCode&&t.stopPropagation()}),i.deferred.codemirror.resolveWith(i,[i.editor.codemirror])},onTabNext:function(){var e,n,i,a=this;i=l.section(a.section()),e=i.controls(),n=e.indexOf(a),e.length===n+1?t("#customize-footer-actions .collapse-sidebar").focus():e[n+1].container.find(":focusable:first").focus()},onTabPrevious:function(){var e,t,n,i=this;n=l.section(i.section()),e=n.controls(),t=e.indexOf(i),0===t?n.contentContainer.find(".customize-section-title .customize-help-toggle, .customize-section-title .customize-section-description.open .section-description-close").last().focus():e[t-1].contentContainer.find(":focusable:first").focus()},onUpdateErrorNotice:function(e){var t,n=this;n.setting.notifications.remove("csslint_error"),0!==e.length&&(t=1===e.length?l.l10n.customCssError.singular.replace("%d","1"):l.l10n.customCssError.plural.replace("%d",String(e.length)),n.setting.notifications.add(new l.Notification("csslint_error",{message:t,type:"error"})))},initPlainTextareaEditor:function(){var e=this,t=e.container.find("textarea"),n=t[0];t.on("blur",function(){t.data("next-tab-blurs",!1)}),t.on("keydown",function(e){var i,a,o,s=9,r=27
;r!==e.keyCode?s!==e.keyCode||e.ctrlKey||e.altKey||e.shiftKey||t.data("next-tab-blurs")||(i=n.selectionStart,a=n.selectionEnd,o=n.value,i>=0&&(n.value=o.substring(0,i).concat("\t",o.substring(a)),t.selectionStart=n.selectionEnd=i+1),e.stopPropagation(),e.preventDefault()):t.data("next-tab-blurs")||(t.data("next-tab-blurs",!0),e.stopPropagation())}),e.deferred.codemirror.rejectWith(e)}}),l.DateTimeControl=l.Control.extend({ready:function(){var e=this;if(e.inputElements={},e.invalidDate=!1,_.bindAll(e,"populateSetting","updateDaysForMonth","populateDateInputs"),!e.setting)throw new Error("Missing setting");e.container.find(".date-input").each(function(){var n,i,a=t(this);n=a.data("component"),i=new l.Element(a),e.inputElements[n]=i,e.elements.push(i),a.on("change",function(){e.invalidDate&&e.notifications.add(new l.Notification("invalid_date",{message:l.l10n.invalidDate}))}),a.on("input",_.debounce(function(){e.invalidDate||e.notifications.remove("invalid_date")})),a.on("blur",_.debounce(function(){e.invalidDate||e.populateDateInputs()}))}),e.inputElements.month.bind(e.updateDaysForMonth),e.inputElements.year.bind(e.updateDaysForMonth),e.populateDateInputs(),e.setting.bind(e.populateDateInputs),_.each(e.inputElements,function(t){t.bind(e.populateSetting)})},parseDateTime:function(e){var t,n,i=this,a=12;return e&&(t=e.match(/^(\d\d\d\d)-(\d\d)-(\d\d)(?: (\d\d):(\d\d)(?::(\d\d))?)?$/)),t?(t.shift(),n={year:t.shift(),month:t.shift(),day:t.shift(),hour:t.shift()||"00",minute:t.shift()||"00",second:t.shift()||"00"},i.params.includeTime&&i.params.twelveHourFormat&&(n.hour=parseInt(n.hour,10),n.meridian=n.hour>=a?"pm":"am",n.hour=n.hour%a?String(n.hour%a):String(a),delete n.second),n):null},validateInputs:function(){var e,t,n=this;return n.invalidDate=!1,e=["year","day"],n.params.includeTime&&e.push("hour","minute"),_.find(e,function(e){var i,a,o,s;return i=n.inputElements[e],t=i.element.get(0),a=parseInt(i.element.attr("max"),10),o=parseInt(i.element.attr("min"),10),s=parseInt(i(),10),n.invalidDate=isNaN(s)||s>a||s<o,n.invalidDate||t.setCustomValidity(""),n.invalidDate}),n.inputElements.meridian&&!n.invalidDate&&(t=n.inputElements.meridian.element.get(0),"am"!==n.inputElements.meridian.get()&&"pm"!==n.inputElements.meridian.get()?n.invalidDate=!0:t.setCustomValidity("")),n.invalidDate?t.setCustomValidity(l.l10n.invalidValue):t.setCustomValidity(""),(!n.section()||l.section.has(n.section())&&l.section(n.section()).expanded())&&_.result(t,"reportValidity"),n.invalidDate},updateDaysForMonth:function(){var e,t,n,i,a=this;n=parseInt(a.inputElements.month(),10),t=parseInt(a.inputElements.year(),10),i=parseInt(a.inputElements.day(),10),n&&t&&(e=new Date(t,n,0).getDate(),a.inputElements.day.element.attr("max",e),i>e&&a.inputElements.day(String(e)))},populateSetting:function(){var e,t=this;return!(t.validateInputs()||!t.params.allowPastDate&&!t.isFutureDate())&&(e=t.convertInputDateToString(),t.setting.set(e),!0)},convertInputDateToString:function(){var e,t,n,i,a=this,o="";return i=function(e,t){var n;return String(e).length<t&&(n=t-String(e).length,e=Math.pow(10,n).toString().substr(1)+String(e)),e},n=function(e){var t=parseInt(a.inputElements[e].get(),10);return _.contains(["month","day","hour","minute"],e)?t=i(t,2):"year"===e&&(t=i(t,4)),t},e=["year","-","month","-","day"],a.params.includeTime&&(t=a.inputElements.meridian?a.convertHourToTwentyFourHourFormat(a.inputElements.hour(),a.inputElements.meridian()):a.inputElements.hour(),e=e.concat([" ",i(t,2),":","minute",":","00"])),_.each(e,function(e){o+=a.inputElements[e]?n(e):e}),o},isFutureDate:function(){var e=this;return 0<l.utils.getRemainingTime(e.convertInputDateToString())},convertHourToTwentyFourHourFormat:function(e,t){var n,i,a=12;return i=parseInt(e,10),isNaN(i)?"":(n="pm"===t&&i<a?i+a:"am"===t&&a===i?i-a:i,String(n))},populateDateInputs:function(){var e,t=this;return e=t.parseDateTime(t.setting.get()),!!e&&(_.each(t.inputElements,function(t,n){var i=e[n];"month"===n||"meridian"===n?(i=i.replace(/^0/,""),t.set(i)):(i=parseInt(i,10),t.element.is(document.activeElement)?i!==parseInt(t(),10)&&t.set(String(i)):t.set(e[n]))}),!0)},toggleFutureDateNotification:function(e){var t,n,i=this;return t="not_future_date",e?(n=new l.Notification(t,{type:"error",message:l.l10n.futureDateError}),i.notifications.add(n)):i.notifications.remove(t),i}}),l.PreviewLinkControl=l.Control.extend({defaults:_.extend({},l.Control.prototype.defaults,{templateId:"customize-preview-link-control"}),ready:function(){var e,n,i,a,o,s,r=this;_.bindAll(r,"updatePreviewLink"),r.setting||(r.setting=new l.Value),r.previewElements={},r.container.find(".preview-control-element").each(function(){i=t(this),n=i.data("component"),e=new l.Element(i),r.previewElements[n]=e,r.elements.push(e)}),a=r.previewElements.url,o=r.previewElements.input,s=r.previewElements.button,o.link(r.setting),a.link(r.setting),a.bind(function(e){a.element.parent().attr({href:e,target:l.settings.changeset.uuid})}),l.bind("ready",r.updatePreviewLink),l.state("saved").bind(r.updatePreviewLink),l.state("changesetStatus").bind(r.updatePreviewLink),l.state("activated").bind(r.updatePreviewLink),l.previewer.previewUrl.bind(r.updatePreviewLink),s.element.on("click",function(e){e.preventDefault(),r.setting()&&(o.element.select(),document.execCommand("copy"),s(s.element.data("copied-text")))}),a.element.parent().on("click",function(e){t(this).hasClass("disabled")&&e.preventDefault()}),s.element.on("mouseenter",function(){r.setting()&&s(s.element.data("copy-text"))})},updatePreviewLink:function(){var e,t=this;e=!l.state("saved").get()||""===l.state("changesetStatus").get()||"auto-draft"===l.state("changesetStatus").get(),t.toggleSaveNotification(e),t.previewElements.url.element.parent().toggleClass("disabled",e),t.previewElements.button.element.prop("disabled",e),t.setting.set(l.previewer.getFrontendPreviewUrl())},toggleSaveNotification:function(e){var t,n,i=this;t="changes_not_saved",e?(n=new l.Notification(t,{type:"info",message:l.l10n.saveBeforeShare}),i.notifications.add(n)):i.notifications.remove(t)}}),l.defaultConstructor=l.Setting,l.control=new l.Values({defaultConstructor:l.Control}),l.section=new l.Values({defaultConstructor:l.Section}),l.panel=new l.Values({defaultConstructor:l.Panel}),l.notifications=new l.Notifications,l.PreviewFrame=l.Messenger.extend({sensitivity:null,initialize:function(e,n){var i=t.Deferred();i.promise(this),this.container=e.container,t.extend(e,{channel:l.PreviewFrame.uuid()}),l.Messenger.prototype.initialize.call(this,e,n),this.add("previewUrl",e.previewUrl),this.query=t.extend(e.query||{},{customize_messenger_channel:this.channel()}),this.run(i)},run:function(e){var n,i,a,o=this,s=!1,r=!1,c=null,d="{}"!==o.query.customized;o._ready&&o.unbind("ready",o._ready),o._ready=function(t){r=!0,c=t,o.container.addClass("iframe-ready"),t&&s&&e.resolveWith(o,[t])},o.bind("ready",o._ready),n=document.createElement("a"),n.href=o.previewUrl(),i=_.extend(l.utils.parseQueryString(n.search.substr(1)),{customize_changeset_uuid:o.query.customize_changeset_uuid,customize_theme:o.query.customize_theme,customize_messenger_channel:o.query.customize_messenger_channel}),!l.settings.changeset.autosaved&&l.state("saved").get()||(i.customize_autosaved="on"),n.search=t.param(i),o.iframe=t("<iframe />",{title:l.l10n.previewIframeTitle,name:"customize-"+o.channel()}),o.iframe.attr("onmousewheel",""),d?o.iframe.attr("data-src",n.href):o.iframe.attr("src",n.href),o.iframe.appendTo(o.container),o.targetWindow(o.iframe[0].contentWindow),d&&(a=t("<form>",{action:n.href,target:o.iframe.attr("name"),method:"post",hidden:"hidden"}),a.append(t("<input>",{type:"hidden",name:"_method",value:"GET"})),_.each(o.query,function(e,n){a.append(t("<input>",{type:"hidden",name:n,value:e}))}),o.container.append(a),a.submit(),a.remove()),o.bind("iframe-loading-error",function(t){o.iframe.remove(),0!==t?-1!==t?e.rejectWith(o,["request failure"]):e.rejectWith(o,["cheatin"]):o.login(e)}),o.iframe.one("load",function(){s=!0,r?e.resolveWith(o,[c]):setTimeout(function(){e.rejectWith(o,["ready timeout"])},o.sensitivity)})},login:function(e){var n,i=this;if(n=function(){e.rejectWith(i,["logged out"])},this.triedLogin)return n();t.get(l.settings.url.ajax,{action:"logged-in"}).fail(n).done(function(a){var o;"1"!==a&&n(),o=t("<iframe />",{src:i.previewUrl(),title:l.l10n.previewIframeTitle}).hide(),o.appendTo(i.container),o.on("load",function(){i.triedLogin=!0,o.remove(),i.run(e)})})},destroy:function(){l.Messenger.prototype.destroy.call(this),this.iframe&&this.iframe.remove(),delete this.iframe,delete this.targetWindow}}),c=0,l.PreviewFrame.uuid=function(){return"preview-"+String(c++)},l.setDocumentTitle=function(e){var t,n;t=l.settings.documentTitleTmpl,n=t.replace("%s",e),document.title=n,l.trigger("title",n)},l.Previewer=l.Messenger.extend({refreshBuffer:null,initialize:function(e,n){var i,a=this,o=document.createElement("a");t.extend(a,n||{}),a.deferred={active:t.Deferred()},a.refresh=_.debounce((i=a.refresh,function(){var e,t;e=function(){return 0===l.state("processing").get()},e()?i.call(a):(t=function(){e()&&(i.call(a),l.state("processing").unbind(t))},l.state("processing").bind(t))}),a.refreshBuffer),a.container=l.ensure(e.container),a.allowedUrls=e.allowedUrls,e.url=window.location.href,l.Messenger.prototype.initialize.call(a,e),o.href=a.origin(),a.add("scheme",o.protocol.replace(/:$/,"")),a.add("previewUrl",e.previewUrl).setter(function(e){var n,i,o,s=null,r=[];return n=document.createElement("a"),n.href=e,/\/wp-(admin|includes|content)(\/|$)/.test(n.pathname)?null:(n.search.length>1&&(i=l.utils.parseQueryString(n.search.substr(1)),delete i.customize_changeset_uuid,delete i.customize_theme,delete i.customize_messenger_channel,delete i.customize_autosaved,_.isEmpty(i)?n.search="":n.search=t.param(i)),r.push(n),a.scheme.get()+":"!==n.protocol&&(n=document.createElement("a"),n.href=r[0].href,n.protocol=a.scheme.get()+":",r.unshift(n)),o=document.createElement("a"),_.find(r,function(e){return!_.isUndefined(_.find(a.allowedUrls,function(t){if(o.href=t,n.protocol===o.protocol&&n.host===o.host&&0===n.pathname.indexOf(o.pathname.replace(/\/$/,"")))return s=e.href,!0}))}),s)}),a.bind("ready",a.ready),a.deferred.active.done(_.bind(a.keepPreviewAlive,a)),a.bind("synced",function(){a.send("active")}),a.previewUrl.bind(a.refresh),a.scroll=0,a.bind("scroll",function(e){a.scroll=e}),a.bind("url",function(e){var t,n=!1;a.scroll=0,t=function(){n=!0},a.previewUrl.bind(t),a.previewUrl.set(e),a.previewUrl.unbind(t),n||a.refresh()}),a.bind("documentTitle",function(e){l.setDocumentTitle(e)})},ready:function(e){var t,n=this,i={};i.settings=l.get(),i["settings-modified-while-loading"]=n.settingsModifiedWhileLoading,("resolved"!==n.deferred.active.state()||n.loading)&&(i.scroll=n.scroll),i["edit-shortcut-visibility"]=l.state("editShortcutVisibility").get(),n.send("sync",i),e.currentUrl&&(n.previewUrl.unbind(n.refresh),n.previewUrl.set(e.currentUrl),n.previewUrl.bind(n.refresh)),t={panel:e.activePanels,section:e.activeSections,control:e.activeControls},_(t).each(function(e,t){l[t].each(function(n,i){var a=_.isUndefined(l.settings[t+"s"][i]);a&&_.isUndefined(e[i])||(e[i]?n.activate():n.deactivate())})}),e.settingValidities&&l._handleSettingValidities({settingValidities:e.settingValidities,focusInvalidControl:!1})},keepPreviewAlive:function(){var e,t,n,i,a=this;i=function(){t=setTimeout(n,l.settings.timeouts.keepAliveCheck)},e=function(){l.state("previewerAlive").set(!0),clearTimeout(t),i()},n=function(){l.state("previewerAlive").set(!1)},i(),a.bind("ready",e),a.bind("keep-alive",e)},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var e,t=this;t.send("loading-initiated"),t.abort(),t.loading=new l.PreviewFrame({url:t.url(),previewUrl:t.previewUrl(),query:t.query({excludeCustomizedSaved:!0})||{},container:t.container}),t.settingsModifiedWhileLoading={},e=function(e){t.settingsModifiedWhileLoading[e.id]=!0},l.bind("change",e),t.loading.always(function(){l.unbind("change",e)}),t.loading.done(function(e){var n,i=this;t.preview=i,t.targetWindow(i.targetWindow()),t.channel(i.channel()),n=function(){i.unbind("synced",n),t._previousPreview&&t._previousPreview.destroy(),t._previousPreview=t.preview,t.deferred.active.resolve(),delete t.loading},i.bind("synced",n),t.trigger("ready",e)}),t.loading.fail(function(e){t.send("loading-failed"),"logged out"===e&&(t.preview&&(t.preview.destroy(),delete t.preview),t.login().done(t.refresh)),"cheatin"===e&&t.cheatin()})},login:function(){var e,n,i,a=this;return this._login?this._login:(e=t.Deferred(),this._login=e.promise(),n=new l.Messenger({channel:"login",url:l.settings.url.login}),i=t("<iframe />",{src:l.settings.url.login,title:l.l10n.loginIframeTitle}).appendTo(this.container),n.targetWindow(i[0].contentWindow),n.bind("login",function(){var t=a.refreshNonces();t.always(function(){i.remove(),n.destroy(),delete a._login}),t.done(function(){e.resolve()}),t.fail(function(){a.cheatin(),e.reject()})}),this._login)},cheatin:function(){t(document.body).empty().addClass("cheatin").append("<h1>"+l.l10n.notAllowedHeading+"</h1><p>"+l.l10n.notAllowed+"</p>")},refreshNonces:function(){var e,n=t.Deferred();return n.promise(),e=wp.ajax.post("customize_refresh_nonces",{wp_customize:"on",customize_theme:l.settings.theme.stylesheet}),e.done(function(e){l.trigger("nonce-refresh",e),n.resolve()}),e.fail(function(){n.reject()}),n}}),l.settingConstructor={},l.controlConstructor={color:l.ColorControl,media:l.MediaControl,upload:l.UploadControl,image:l.ImageControl,cropped_image:l.CroppedImageControl,site_icon:l.SiteIconControl,header:l.HeaderControl,background:l.BackgroundControl,background_position:l.BackgroundPositionControl,theme:l.ThemeControl,date_time:l.DateTimeControl,code_editor:l.CodeEditorControl},l.panelConstructor={themes:l.ThemesPanel},l.sectionConstructor={themes:l.ThemesSection,outer:l.OuterSection},l._handleSettingValidities=function(e){var t,n=[],i=!1;_.each(e.settingValidities,function(e,t){var i=l(t);i&&(_.isObject(e)&&_.each(e,function(e,t){var a,o,s=!1;a=new l.Notification(t,_.extend({fromServer:!0},e)),o=i.notifications(a.code),o&&(s=a.type!==o.type||a.message!==o.message||!_.isEqual(a.data,o.data)),s&&i.notifications.remove(t),i.notifications.has(a.code)||i.notifications.add(a),n.push(i.id)}),i.notifications.each(function(t){!t.fromServer||"error"!==t.type||!0!==e&&e[t.code]||i.notifications.remove(t.code)}))}),e.focusInvalidControl&&(t=l.findControlsForSettings(n),_(_.values(t)).find(function(e){return _(e).find(function(e){var t=e.section()&&l.section.has(e.section())&&l.section(e.section()).expanded();return t&&e.expanded&&(t=e.expanded()),t&&(e.focus(),i=!0),i})}),i||_.isEmpty(t)||_.values(t)[0][0].focus())},l.findControlsForSettings=function(e){var t,n={};return _.each(_.unique(e),function(e){var i=l(e);i&&(t=i.findControls(),t&&t.length>0&&(n[e]=t))}),n},l.reflowPaneContents=_.bind(function(){var e,n,i,a=[],o=!1;document.activeElement&&(n=t(document.activeElement)),l.panel.each(function(t){if("themes"!==t.id){var n=t.sections(),i=_.pluck(n,"headContainer");a.push(t),e=t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first"),l.utils.areElementListsEqual(i,e.children("[id]"))||(_(n).each(function(t){e.append(t.headContainer)}),o=!0)}}),l.section.each(function(t){var n=t.controls(),i=_.pluck(n,"container");t.panel()||a.push(t),e=t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first"),l.utils.areElementListsEqual(i,e.children("[id]"))||(_(n).each(function(t){e.append(t.container)}),o=!0)}),a.sort(l.utils.prioritySort),i=_.pluck(a,"headContainer"),e=t("#customize-theme-controls .customize-pane-parent"),l.utils.areElementListsEqual(i,e.children())||(_(a).each(function(t){e.append(t.headContainer)}),o=!0),l.panel.each(function(e){var t=e.active();e.active.callbacks.fireWith(e.active,[t,t])}),l.section.each(function(e){var t=e.active();e.active.callbacks.fireWith(e.active,[t,t])}),o&&n&&n.focus(),l.trigger("pane-contents-reflowed")},l),l.state=new l.Values,_.each(["saved","saving","trashing","activated","processing","paneVisible","expandedPanel","expandedSection","changesetDate","selectedChangesetDate","changesetStatus","selectedChangesetStatus","remainingTimeToPublish","previewerAlive","editShortcutVisibility","changesetLocked","previewedDevice"],function(e){l.state.create(e)}),t(function(){function e(){function n(e){e||l.settings.changeset.autosaved||(l.settings.changeset.autosaved=!0,l.previewer.send("autosaving"))}var i,a,o,s=!1;l.unbind("change",e),l.state("saved").bind(n),n(l.state("saved").get()),a=function(){s||(s=!0,l.requestChangesetUpdate({},{autosave:!0}).always(function(){s=!1})),o()},o=function(){clearTimeout(i),i=setTimeout(function(){a()},l.settings.timeouts.changesetAutoSave)},o(),t(document).on("visibilitychange.wp-customize-changeset-update",function(){document.hidden&&a()}),t(window).on("beforeunload.wp-customize-changeset-update",function(){a()})}if(l.settings=window._wpCustomizeSettings,l.l10n=window._wpCustomizeControlsL10n,l.settings&&t.support.postMessage&&(t.support.cors||!l.settings.isCrossDomain)){null===l.PreviewFrame.prototype.sensitivity&&(l.PreviewFrame.prototype.sensitivity=l.settings.timeouts.previewFrameSensitivity),null===l.Previewer.prototype.refreshBuffer&&(l.Previewer.prototype.refreshBuffer=l.settings.timeouts.windowRefresh);var n,i,a,o,s,r,c,d,u,p,h,f,m,g,v,w,b,C,y,x,k,z,S,T,E,D,P,N,I=t(document.body),U=I.children(".wp-full-overlay"),A=t("#customize-info .panel-title.site-title"),F=t(".customize-controls-close"),V=t("#save"),H=t("#customize-save-button-wrapper"),L=t("#publish-settings"),M=t("#customize-footer-actions");l.bind("ready",function(){l.section.add(new l.OuterSection("publish_settings",{title:l.l10n.publishSettings,priority:0,active:l.settings.theme.active}))}),l.section("publish_settings",function(e){function t(){f||(f=l.utils.highlightButton(H,{delay:1e3,focusTarget:V}))}function n(){f&&(f(),f=null)}var i,a,o,s,r,c,d,u,p,h,f,m=1e3;a=new l.Control("trash_changeset",{type:"button",section:e.id,priority:30,input_attrs:{class:"button-link button-link-delete",value:l.l10n.discardChanges}}),l.control.add(a),a.deferred.embedded.done(function(){a.container.find(".button-link").on("click",function(){confirm(l.l10n.trashConfirm)&&wp.customize.previewer.trash()})}),l.control.add(new l.PreviewLinkControl("changeset_preview_link",{section:e.id,priority:100})),s=function(){return!!l.state("activated").get()&&(!l.state("trashing").get()&&"trash"!==l.state("changesetStatus").get()&&(""!==l.state("changesetStatus").get()||!l.state("saved").get()))},e.active.validate=s,o=function(){e.active.set(s())},l.state("activated").bind(o),l.state("trashing").bind(o),l.state("saved").bind(o),l.state("changesetStatus").bind(o),o(),i=function(){L.toggle(e.active.get()),V.toggleClass("has-next-sibling",e.active.get())},i(),e.active.bind(i),l.state("selectedChangesetStatus").bind(n),e.contentContainer.find(".customize-action").text(l.l10n.updating),e.contentContainer.find(".customize-section-back").removeAttr("tabindex"),L.prop("disabled",!1),L.on("click",function(t){t.preventDefault(),e.expanded.set(!e.expanded.get())}),e.expanded.bind(function(e){var i;L.attr("aria-expanded",String(e)),L.toggleClass("active",e),e?n():(i=l.state("changesetStatus").get(),""!==i&&"auto-draft"!==i||(i="publish"),l.state("selectedChangesetStatus").get()!==i?t():"future"===l.state("selectedChangesetStatus").get()&&l.state("selectedChangesetDate").get()!==l.state("changesetDate").get()&&t())}),r=new l.Control("changeset_status",{priority:10,type:"radio",section:"publish_settings",setting:l.state("selectedChangesetStatus"),templateId:"customize-selected-changeset-status-control",label:l.l10n.action,choices:l.settings.changeset.statusChoices}),l.control.add(r),c=new l.DateTimeControl("changeset_scheduled_date",{priority:20,section:"publish_settings",setting:l.state("selectedChangesetDate"),minYear:(new Date).getFullYear(),allowPastDate:!1,includeTime:!0,twelveHourFormat:/a/i.test(l.settings.timeFormat),description:l.l10n.scheduleDescription}),c.notifications.alt=!0,l.control.add(c),u=function(){l.state("selectedChangesetStatus").set("publish"),l.previewer.save()},h=function(){var e="future"===l.state("changesetStatus").get()&&"future"===l.state("selectedChangesetStatus").get()&&l.state("changesetDate").get()&&l.state("selectedChangesetDate").get()===l.state("changesetDate").get()&&l.utils.getRemainingTime(l.state("changesetDate").get())>=0;e&&!p?p=setInterval(function(){var e=l.utils.getRemainingTime(l.state("changesetDate").get());l.state("remainingTimeToPublish").set(e),e<=0&&(clearInterval(p),p=0,u())},m):!e&&p&&(clearInterval(p),p=0)},l.state("changesetDate").bind(h),l.state("selectedChangesetDate").bind(h),l.state("changesetStatus").bind(h),l.state("selectedChangesetStatus").bind(h),h(),c.active.validate=function(){return"future"===l.state("selectedChangesetStatus").get()},d=function(e){c.active.set("future"===e)},d(l.state("selectedChangesetStatus").get()),l.state("selectedChangesetStatus").bind(d),l.state("saving").bind(function(e){e&&"future"===l.state("selectedChangesetStatus").get()&&c.toggleFutureDateNotification(!c.isFutureDate())})}),t("#customize-controls").on("keydown",function(e){var n=13===e.which,i=t(e.target);n&&(i.is("input:not([type=button])")||i.is("select"))&&e.preventDefault()}),t(".customize-info").find("> .accordion-section-title .customize-help-toggle").on("click",function(){var e=t(this).closest(".accordion-section"),n=e.find(".customize-panel-description:first");e.hasClass("cannot-expand")||(e.hasClass("open")?(e.toggleClass("open"),n.slideUp(l.Panel.prototype.defaultExpandedArguments.duration,function(){n.trigger("toggled")}),t(this).attr("aria-expanded",!1)):(n.slideDown(l.Panel.prototype.defaultExpandedArguments.duration,function(){n.trigger("toggled")}),e.toggleClass("open"),t(this).attr("aria-expanded",!0)))}),l.previewer=new l.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:l.settings.url.preview,allowedUrls:l.settings.url.allowed},{nonce:l.settings.nonce,query:function(e){var t={wp_customize:"on",customize_theme:l.settings.theme.stylesheet,nonce:this.nonce.preview,customize_changeset_uuid:l.settings.changeset.uuid};return!l.settings.changeset.autosaved&&l.state("saved").get()||(t.customize_autosaved="on"),t.customized=JSON.stringify(l.dirtyValues({unsaved:e&&e.excludeCustomizedSaved})),t},save:function(e){function i(e){p[e.id]=!0}var a,o,s=this,r=t.Deferred(),c=l.state("selectedChangesetStatus").get(),d=l.state("selectedChangesetDate").get(),u=l.state("processing"),p={},h=[],f=[],m=[];return e&&e.status&&(c=e.status),l.state("saving").get()&&(r.reject("already_saving"),r.promise()),l.state("saving").set(!0),o=function(){var a,o,u={},g=l._latestRevision,v="client_side_error";if(l.bind("change",i),l.notifications.remove(v),l.each(function(e){e.notifications.each(function(t){"error"!==t.type||t.fromServer||(h.push(e.id),u[e.id]||(u[e.id]={}),u[e.id][t.code]=t)})}),l.control.each(function(e){(!e.setting||!e.setting.id&&e.active.get())&&e.notifications.each(function(t){"error"===t.type&&m.push([e])})}),f=_.union(m,_.values(l.findControlsForSettings(h))),!_.isEmpty(f))return f[0][0].focus(),l.unbind("change",i),h.length&&l.notifications.add(new l.Notification(v,{message:(1===h.length?l.l10n.saveBlockedError.singular:l.l10n.saveBlockedError.plural).replace(/%s/g,String(h.length)),type:"error",dismissible:!0,saveFailure:!0})),r.rejectWith(s,[{setting_invalidities:u}]),l.state("saving").set(!1),r.promise();o=t.extend(s.query({excludeCustomizedSaved:!1}),{nonce:s.nonce.save,customize_changeset_status:c}),e&&e.date?o.customize_changeset_date=e.date:"future"===c&&d&&(o.customize_changeset_date=d),e&&e.title&&(o.customize_changeset_title=e.title),l.trigger("save-request-params",o),a=wp.ajax.post("customize_save",o),l.state("processing").set(l.state("processing").get()+1),l.trigger("save",a),a.always(function(){l.state("processing").set(l.state("processing").get()-1),l.state("saving").set(!1),l.unbind("change",i)}),l.notifications.each(function(e){e.saveFailure&&l.notifications.remove(e.code)}),a.fail(function(e){var t,i;i={type:"error",dismissible:!0,fromServer:!0,saveFailure:!0},"0"===e?e="not_logged_in":"-1"===e&&(e="invalid_nonce"),"invalid_nonce"===e?s.cheatin():"not_logged_in"===e?(s.preview.iframe.hide(),s.login().done(function(){s.save(),s.preview.iframe.show()})):e.code?"not_future_date"===e.code&&l.section.has("publish_settings")&&l.section("publish_settings").active.get()&&l.control.has("changeset_scheduled_date")?l.control("changeset_scheduled_date").toggleFutureDateNotification(!0).focus():"changeset_locked"!==e.code&&(t=new l.Notification(e.code,_.extend(i,{message:e.message}))):t=new l.Notification("unknown_error",_.extend(i,{message:l.l10n.unknownRequestFail})),t&&l.notifications.add(t),e.setting_validities&&l._handleSettingValidities({settingValidities:e.setting_validities,focusInvalidControl:!0}),r.rejectWith(s,[e]),l.trigger("error",e),"changeset_already_published"===e.code&&e.next_changeset_uuid&&(l.settings.changeset.uuid=e.next_changeset_uuid,l.state("changesetStatus").set(""),l.settings.changeset.branching&&n.send("changeset-uuid",l.settings.changeset.uuid),l.previewer.send("changeset-uuid",l.settings.changeset.uuid))}),a.done(function(e){s.send("saved",e),l.state("changesetStatus").set(e.changeset_status),e.changeset_date&&l.state("changesetDate").set(e.changeset_date),"publish"===e.changeset_status&&(l.each(function(e){e._dirty&&(_.isUndefined(l._latestSettingRevisions[e.id])||l._latestSettingRevisions[e.id]<=g)&&(e._dirty=!1)}),l.state("changesetStatus").set(""),l.settings.changeset.uuid=e.next_changeset_uuid,l.settings.changeset.branching&&n.send("changeset-uuid",l.settings.changeset.uuid)),l._lastSavedRevision=Math.max(g,l._lastSavedRevision),e.setting_validities&&l._handleSettingValidities({settingValidities:e.setting_validities,focusInvalidControl:!0}),r.resolveWith(s,[e]),l.trigger("saved",e),_.isEmpty(p)||l.state("saved").set(!1)})},0===u()?o():(a=function(){0===u()&&(l.state.unbind("change",a),o())},l.state.bind("change",a)),r.promise()},trash:function(){var e,n,i;l.state("trashing").set(!0),l.state("processing").set(l.state("processing").get()+1),e=wp.ajax.post("customize_trash",{customize_changeset_uuid:l.settings.changeset.uuid,nonce:l.settings.nonce.trash}),l.notifications.add(new l.OverlayNotification("changeset_trashing",{type:"info",message:l.l10n.revertingChanges,loading:!0})),n=function(){var e,n=document.createElement("a");l.state("changesetStatus").set("trash"),l.each(function(e){e._dirty=!1}),l.state("saved").set(!0),n.href=location.href,e=l.utils.parseQueryString(n.search.substr(1)),delete e.changeset_uuid,e.return=l.settings.url.return,n.search=t.param(e),location.replace(n.href)},i=function(e,t){var n=e||"unknown_error";l.state("processing").set(l.state("processing").get()-1),l.state("trashing").set(!1),l.notifications.remove("changeset_trashing"),l.notifications.add(new l.Notification(n,{message:t||l.l10n.unknownError,dismissible:!0,type:"error"}))},e.done(function(e){n(e.message)}),e.fail(function(e){var t=e.code||"trashing_failed";e.success||"non_existent_changeset"===t||"changeset_already_trashed"===t?n(e.message):i(t,e.message)})},getFrontendPreviewUrl:function(){var e,n,i=this;return n=document.createElement("a"),n.href=i.previewUrl.get(),e=l.utils.parseQueryString(n.search.substr(1)),l.state("changesetStatus").get()&&"publish"!==l.state("changesetStatus").get()&&(e.customize_changeset_uuid=l.settings.changeset.uuid),l.state("activated").get()||(e.customize_theme=l.settings.theme.stylesheet),n.search=t.param(e),n.href}}),t.ajaxPrefilter(function(e){/wp_customize=on/.test(e.data)&&(e.data+="&"+t.param({customize_preview_nonce:l.settings.nonce.preview}))}),l.previewer.bind("nonce",function(e){t.extend(this.nonce,e)}),l.bind("nonce-refresh",function(e){t.extend(l.settings.nonce,e),t.extend(l.previewer.nonce,e),l.previewer.send("nonce-refresh",e)}),t.each(l.settings.settings,function(e,t){var n=l.settingConstructor[t.type]||l.Setting;l.add(new n(e,t.value,{transport:t.transport,previewer:l.previewer,dirty:!!t.dirty}))}),t.each(l.settings.panels,function(e,t){var n,i=l.panelConstructor[t.type]||l.Panel;n=_.extend({params:t},t),l.panel.add(new i(e,n))}),t.each(l.settings.sections,function(e,t){var n,i=l.sectionConstructor[t.type]||l.Section;n=_.extend({params:t},t),l.section.add(new i(e,n))}),t.each(l.settings.controls,function(e,t){var n,i=l.controlConstructor[t.type]||l.Control;n=_.extend({params:t},t),l.control.add(new i(e,n))}),_.each(["panel","section","control"],function(e){var t=l.settings.autofocus[e];t&&l[e](t,function(e){e.deferred.embedded.done(function(){l.previewer.deferred.active.done(function(){e.focus()})})})}),l.bind("ready",l.reflowPaneContents),t([l.panel,l.section,l.control]).each(function(e,t){var n=_.debounce(l.reflowPaneContents,l.settings.timeouts.reflowPaneContents);t.bind("add",n),t.bind("change",n),t.bind("remove",n)}),l.bind("ready",function(){var e,n,i;l.notifications.container=t("#customize-notifications-area"),l.notifications.bind("change",_.debounce(function(){l.notifications.render()})),e=t(".wp-full-overlay-sidebar-content"),l.notifications.bind("rendered",function(){e.css("top",""),0!==l.notifications.count()&&(n=l.notifications.container.outerHeight()+1,i=parseInt(e.css("top"),10),e.css("top",i+n+"px")),l.notifications.trigger("sidebarTopUpdated")}),l.notifications.render()}),i=l.state,s=i.instance("saved"),r=i.instance("saving"),c=i.instance("trashing"),d=i.instance("activated"),u=i.instance("processing"),p=i.instance("paneVisible"),h=i.instance("expandedPanel"),f=i.instance("expandedSection"),m=i.instance("changesetStatus"),g=i.instance("selectedChangesetStatus"),v=i.instance("changesetDate"),w=i.instance("selectedChangesetDate"),b=i.instance("previewerAlive"),C=i.instance("editShortcutVisibility"),y=i.instance("changesetLocked"),i.bind("change",function(){var e;d()?""===m.get()&&s()?(l.settings.changeset.currentUserCanPublish?V.val(l.l10n.published):V.val(l.l10n.saved),F.find(".screen-reader-text").text(l.l10n.close)):("draft"===g()?s()&&g()===m()?V.val(l.l10n.draftSaved):V.val(l.l10n.saveDraft):"future"===g()?s()&&g()===m()?v.get()!==w.get()?V.val(l.l10n.schedule):V.val(l.l10n.scheduled):V.val(l.l10n.schedule):l.settings.changeset.currentUserCanPublish&&V.val(l.l10n.publish),F.find(".screen-reader-text").text(l.l10n.cancel)):(V.val(l.l10n.activate),F.find(".screen-reader-text").text(l.l10n.cancel)),e=!r()&&!c()&&!y()&&(!d()||!s()||m()!==g()&&""!==m()||"future"===g()&&v.get()!==w.get()),V.prop("disabled",!e)}),g.validate=function(e){return""===e||"auto-draft"===e?null:e},o=l.settings.changeset.currentUserCanPublish?"publish":"draft",m(l.settings.changeset.status),y(Boolean(l.settings.changeset.lockUser)),v(l.settings.changeset.publishDate),w(l.settings.changeset.publishDate),g(""===l.settings.changeset.status||"auto-draft"===l.settings.changeset.status?o:l.settings.changeset.status),g.link(m),s(!0),""===m()&&l.each(function(e){e._dirty&&s(!1)}),r(!1),d(l.settings.theme.active),u(0),p(!0),h(!1),f(!1),b(!0),C("visible"),l.bind("change",function(){i("saved").get()&&i("saved").set(!1)}),l.settings.changeset.branching&&s.bind(function(e){e||a(!0)}),r.bind(function(e){I.toggleClass("saving",e)}),c.bind(function(e){I.toggleClass("trashing",e)}),l.bind("saved",function(e){i("saved").set(!0),"publish"===e.changeset_status&&i("activated").set(!0)}),d.bind(function(e){e&&l.trigger("activated")}),a=function(e){var n,i;if(history.replaceState){if(n=document.createElement("a"),n.href=location.href,i=l.utils.parseQueryString(n.search.substr(1)),e){if(i.changeset_uuid===l.settings.changeset.uuid)return;i.changeset_uuid=l.settings.changeset.uuid}else{if(!i.changeset_uuid)return
;delete i.changeset_uuid}n.search=t.param(i),history.replaceState({},document.title,n.href)}},l.settings.changeset.branching&&m.bind(function(e){a(""!==e&&"publish"!==e&&"trash"!==e)}),function(){function e(e){e&&e.lockUser&&(l.settings.changeset.lockUser=e.lockUser),l.state("changesetLocked").set(!0),l.notifications.add(new n("changeset_locked",{lockUser:l.settings.changeset.lockUser,allowOverride:Boolean(e&&e.allowOverride)}))}var n=l.OverlayNotification.extend({templateId:"customize-changeset-locked-notification",lockUser:null,initialize:function(e,t){var n,i,a=this;n=e||"changeset_locked",i=_.extend({type:"warning",containerClasses:"",lockUser:{}},t),i.containerClasses+=" notification-changeset-locked",l.OverlayNotification.prototype.initialize.call(a,n,i)},render:function(){var e,t,n,i,a=this;return t=_.extend({allowOverride:!1,returnUrl:l.settings.url.return,previewUrl:l.previewer.previewUrl.get(),frontendPreviewUrl:l.previewer.getFrontendPreviewUrl()},this),e=l.OverlayNotification.prototype.render.call(t),l.requestChangesetUpdate({},{autosave:!0}).fail(function(t){t.autosaved||e.find(".notice-error").prop("hidden",!1).text(t.message||l.l10n.unknownRequestFail)}),n=e.find(".customize-notice-take-over-button"),n.on("click",function(t){t.preventDefault(),i||(n.addClass("disabled"),i=wp.ajax.post("customize_override_changeset_lock",{wp_customize:"on",customize_theme:l.settings.theme.stylesheet,customize_changeset_uuid:l.settings.changeset.uuid,nonce:l.settings.nonce.override_lock}),i.done(function(){l.notifications.remove(a.code),l.state("changesetLocked").set(!1)}),i.fail(function(t){var a=t.message||l.l10n.unknownRequestFail;e.find(".notice-error").prop("hidden",!1).text(a),i.always(function(){n.removeClass("disabled")})}),i.always(function(){i=null}))}),e}});l.settings.changeset.lockUser&&e({allowOverride:!0}),t(document).on("heartbeat-send.update_lock_notice",function(e,t){t.check_changeset_lock=!0,t.changeset_uuid=l.settings.changeset.uuid}),t(document).on("heartbeat-tick.update_lock_notice",function(t,n){var i,a="changeset_locked";n.customize_changeset_lock_user&&(i=l.notifications(a),i&&i.lockUser.id!==l.settings.changeset.lockUser.id&&l.notifications.remove(a),e({lockUser:n.customize_changeset_lock_user}))}),l.bind("error",function(t){"changeset_locked"===t.code&&t.lock_user&&e({lockUser:t.lock_user})})}(),function(){function e(){var e,n;return e=document.createElement("a"),e.href=location.href,n=l.utils.parseQueryString(e.search.substr(1)),l.settings.changeset.latestAutoDraftUuid?n.changeset_uuid=l.settings.changeset.latestAutoDraftUuid:n.customize_autosaved="on",n.return=l.settings.url.return,e.search=t.param(n),e.href}function n(e){var n,i=document.createElement("a"),a=0;i.href=location.href,n=l.utils.parseQueryString(i.search.substr(1)),_.each(e,function(e){void 0!==n[e]&&(a+=1,delete n[e])}),0!==a&&(i.search=t.param(n),history.replaceState({},document.title,i.href))}function i(){s||(wp.ajax.post("customize_dismiss_autosave_or_lock",{wp_customize:"on",customize_theme:l.settings.theme.stylesheet,customize_changeset_uuid:l.settings.changeset.uuid,nonce:l.settings.nonce.dismiss_autosave_or_lock,dismiss_autosave:!0}),s=!0)}function a(){var t,n="autosave_available";l.notifications.add(new l.Notification(n,{message:l.l10n.autosaveNotice,type:"warning",dismissible:!0,render:function(){var t,n=l.Notification.prototype.render.call(this);return t=n.find("a"),t.prop("href",e()),t.on("click",function(t){t.preventDefault(),location.replace(e())}),n.find(".notice-dismiss").on("click",i),n}})),t=function(){i(),l.notifications.remove(n),l.unbind("change",t),l.state("changesetStatus").unbind(t)},l.bind("change",t),l.state("changesetStatus").bind(t)}var o=[],s=!1;l.settings.changeset.autosaved&&(l.state("saved").set(!1),o.push("customize_autosaved")),l.settings.changeset.branching||l.settings.changeset.status&&"auto-draft"!==l.settings.changeset.status||o.push("changeset_uuid"),o.length>0&&n(o),(l.settings.changeset.latestAutoDraftUuid||l.settings.changeset.hasAutosaveRevision)&&a()}(),l.previewer.previewUrl()?l.previewer.refresh():l.previewer.previewUrl(l.settings.url.home),V.click(function(e){l.previewer.save(),e.preventDefault()}).keydown(function(e){9!==e.which&&(13===e.which&&l.previewer.save(),e.preventDefault())}),F.keydown(function(e){9!==e.which&&(13===e.which&&this.click(),e.preventDefault())}),t(".collapse-sidebar").on("click",function(){l.state("paneVisible").set(!l.state("paneVisible").get())}),l.state("paneVisible").bind(function(e){U.toggleClass("preview-only",!e),U.toggleClass("expanded",e),U.toggleClass("collapsed",!e),e?t(".collapse-sidebar").attr({"aria-expanded":"true","aria-label":l.l10n.collapseSidebar}):t(".collapse-sidebar").attr({"aria-expanded":"false","aria-label":l.l10n.expandSidebar})}),I.on("keydown",function(e){var n,i=[],a=[],o=[];if(27===e.which&&(t(e.target).is("body")||t.contains(t("#customize-controls")[0],e.target))&&(l.control.each(function(e){e.expanded&&e.expanded()&&_.isFunction(e.collapse)&&i.push(e)}),l.section.each(function(e){e.expanded()&&a.push(e)}),l.panel.each(function(e){e.expanded()&&o.push(e)}),i.length>0&&0===a.length&&(i.length=0),n=i[0]||a[0]||o[0],n)){if("themes"===n.params.type)return void(I.hasClass("modal-open")?n.closeDetails():l.panel.has("themes")&&l.panel("themes").collapse());n.collapse(),e.preventDefault()}}),t(".customize-controls-preview-toggle").on("click",function(){l.state("paneVisible").set(!l.state("paneVisible").get())}),P=t(".wp-full-overlay-sidebar-content"),x=function(e){var t,n=e,i=l.state("expandedSection").get(),a=l.state("expandedPanel").get();if(E&&E.element&&(z(E.element),E.element.find(".description").off("toggled",k)),!n)if(!i&&a&&a.contentContainer)n=a;else{if(a||!i||!i.contentContainer)return void(E=!1);n=i}t=n.contentContainer.find(".customize-section-title, .panel-meta").first(),t.length?(E={instance:n,element:t,parent:t.closest(".customize-pane-child"),height:t.outerHeight()},E.element.find(".description").on("toggled",k),i&&S(E.element,E.parent)):E=!1},l.state("expandedSection").bind(x),l.state("expandedPanel").bind(x),P.on("scroll",_.throttle(function(){if(E){var e,t=P.scrollTop();e=D?t===D?0:t>D?1:-1:1,D=t,0!==e&&T(E,t,e)}},8)),l.notifications.bind("sidebarTopUpdated",function(){E&&E.element.hasClass("is-sticky")&&E.element.css("top",P.css("top"))}),z=function(e){e.hasClass("is-sticky")&&e.removeClass("is-sticky").addClass("maybe-sticky is-in-view").css("top",P.scrollTop()+"px")},S=function(e,t){e.hasClass("is-in-view")&&(e.removeClass("maybe-sticky is-in-view").css({width:"",top:""}),t.css("padding-top",""))},k=function(){E.height=E.element.outerHeight()},T=function(e,t,n){var i=e.element,a=e.parent,o=e.height,s=parseInt(i.css("top"),10),r=i.hasClass("maybe-sticky"),c=i.hasClass("is-sticky"),l=i.hasClass("is-in-view"),d=-1===n;if(!d)return c&&(s=t,i.removeClass("is-sticky").css({top:s+"px",width:""})),void(l&&t>s+o&&(i.removeClass("is-in-view"),a.css("padding-top","")));if(!r&&t>=o)r=!0,i.addClass("maybe-sticky");else if(0===t)return i.removeClass("maybe-sticky is-in-view is-sticky").css({top:"",width:""}),void a.css("padding-top","");l&&!c?s>=t&&i.addClass("is-sticky").css({top:P.css("top"),width:a.outerWidth()+"px"}):r&&!l&&(i.addClass("is-in-view").css("top",t-o+"px"),a.css("padding-top",o+"px"))},l.previewedDevice=l.state("previewedDevice"),l.bind("ready",function(){_.find(l.settings.previewableDevices,function(e,t){if(!0===e.default)return l.previewedDevice.set(t),!0})}),M.find(".devices button").on("click",function(e){l.previewedDevice.set(t(e.currentTarget).data("device"))}),l.previewedDevice.bind(function(e){var n=t(".wp-full-overlay"),i="";M.find(".devices button").removeClass("active").attr("aria-pressed",!1),M.find(".devices .preview-"+e).addClass("active").attr("aria-pressed",!0),t.each(l.settings.previewableDevices,function(e){i+=" preview-"+e}),n.removeClass(i).addClass("preview-"+e)}),A.length&&l("blogname",function(e){var n=function(){A.text(t.trim(e())||l.l10n.untitledBlogName)};e.bind(n),n()}),n=new l.Messenger({url:l.settings.url.parent,channel:"loader"}),function(){function e(){var e;return l.state("activated").get()?(e=l.state("changesetStatus").get(),""!==e&&"auto-draft"!==e||(e="publish"),l.state("selectedChangesetStatus").get()===e&&(("future"!==l.state("selectedChangesetStatus").get()||l.state("selectedChangesetDate").get()===l.state("changesetDate").get())&&(l.state("saved").get()&&"auto-draft"!==l.state("changesetStatus").get()))):0===l._latestRevision}function i(){l.unbind("change",i),l.state("selectedChangesetStatus").unbind(i),l.state("selectedChangesetDate").unbind(i),t(window).on("beforeunload.customize-confirm",function(){if(!e()&&!l.state("changesetLocked").get())return setTimeout(function(){U.removeClass("customize-loading")},1),l.l10n.saveAlert})}function a(){var n=t.Deferred(),i=!1,a=!1;return e()?a=!0:confirm(l.l10n.saveAlert)?(a=!0,l.each(function(e){e._dirty=!1}),t(document).off("visibilitychange.wp-customize-changeset-update"),t(window).off("beforeunload.wp-customize-changeset-update"),F.css("cursor","progress"),""!==l.state("changesetStatus").get()&&(i=!0)):n.reject(),(a||i)&&wp.ajax.send("customize_dismiss_autosave_or_lock",{timeout:500,data:{wp_customize:"on",customize_theme:l.settings.theme.stylesheet,customize_changeset_uuid:l.settings.changeset.uuid,nonce:l.settings.nonce.dismiss_autosave_or_lock,dismiss_autosave:i,dismiss_lock:a}}).always(function(){n.resolve()}),n.promise()}var o=!1;n.bind("back",function(){o=!0}),l.bind("change",i),l.state("selectedChangesetStatus").bind(i),l.state("selectedChangesetDate").bind(i),n.bind("confirm-close",function(){a().done(function(){n.send("confirmed-close",!0)}).fail(function(){n.send("confirmed-close",!1)})}),F.on("click.customize-controls-close",function(e){e.preventDefault(),o?n.send("close"):a().done(function(){t(window).off("beforeunload.customize-confirm"),window.location.href=F.prop("href")})})}(),t.each(["saved","change"],function(e,t){l.bind(t,function(){n.send(t)})}),l.bind("title",function(e){n.send("title",e)}),l.settings.changeset.branching&&n.send("changeset-uuid",l.settings.changeset.uuid),n.send("ready"),t.each({background_image:{controls:["background_preset","background_position","background_size","background_repeat","background_attachment"],callback:function(e){return!!e}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(e){return"page"===e}},header_textcolor:{controls:["header_textcolor"],callback:function(e){return"blank"!==e}}},function(e,n){l(e,function(e){t.each(n.controls,function(t,i){l.control(i,function(t){var i=function(e){t.container.toggle(n.callback(e))};i(e.get()),e.bind(i)})})})}),l.control("background_preset",function(e){var t,n,i,a,o,s;t={default:[!1,!1,!1,!1],fill:[!0,!1,!1,!1],fit:[!0,!1,!0,!1],repeat:[!0,!1,!1,!0],custom:[!0,!0,!0,!0]},n=[_wpCustomizeBackground.defaults["default-position-x"],_wpCustomizeBackground.defaults["default-position-y"],_wpCustomizeBackground.defaults["default-size"],_wpCustomizeBackground.defaults["default-repeat"],_wpCustomizeBackground.defaults["default-attachment"]],i={default:n,fill:["left","top","cover","no-repeat","fixed"],fit:["left","top","contain","no-repeat","fixed"],repeat:["left","top","auto","repeat","scroll"]},a=function(e){_.each(["background_position","background_size","background_repeat","background_attachment"],function(n,i){var a=l.control(n);a&&a.container.toggle(t[e][i])})},o=function(e){_.each(["background_position_x","background_position_y","background_size","background_repeat","background_attachment"],function(t,n){var a=l(t);a&&a.set(i[e][n])})},s=e.setting.get(),a(s),e.setting.bind("change",function(e){a(e),"custom"!==e&&o(e)})}),l.control("background_repeat",function(e){e.elements[0].unsync(l("background_repeat")),e.element=new l.Element(e.container.find("input")),e.element.set("no-repeat"!==e.setting()),e.element.bind(function(t){e.setting.set(t?"repeat":"no-repeat")}),e.setting.bind(function(t){e.element.set("no-repeat"!==t)})}),l.control("background_attachment",function(e){e.elements[0].unsync(l("background_attachment")),e.element=new l.Element(e.container.find("input")),e.element.set("fixed"!==e.setting()),e.element.bind(function(t){e.setting.set(t?"scroll":"fixed")}),e.setting.bind(function(t){e.element.set("fixed"!==t)})}),l.control("display_header_text",function(e){var t="";e.elements[0].unsync(l("header_textcolor")),e.element=new l.Element(e.container.find("input")),e.element.set("blank"!==e.setting()),e.element.bind(function(n){n||(t=l("header_textcolor").get()),e.setting.set(n?t:"blank")}),e.setting.bind(function(t){e.element.set("blank"!==t)})}),l("show_on_front","page_on_front","page_for_posts",function(e,t,n){var i=function(){var i,a,o=this,s="show_on_front_page_collision";i=parseInt(t(),10),a=parseInt(n(),10),"page"===e()&&(o===t&&i>0&&l.previewer.previewUrl.set(l.settings.url.home),o===n&&a>0&&l.previewer.previewUrl.set(l.settings.url.home+"?page_id="+a)),"page"===e()&&i&&a&&i===a?e.notifications.add(new l.Notification(s,{type:"error",message:l.l10n.pageOnFrontError})):e.notifications.remove(s)};e.bind(i),t.bind(i),n.bind(i),i.call(e,e()),l.control("show_on_front",function(e){e.deferred.embedded.done(function(){e.container.append(e.getNotificationsContainerElement())})})}),N=t.Deferred(),l.section("custom_css",function(e){e.deferred.embedded.done(function(){e.expanded()?N.resolve(e):e.expanded.bind(function(t){t&&N.resolve(e)})})}),N.done(function(e){var t=l.control("custom_css");t.container.find(".customize-control-title:first").addClass("screen-reader-text"),e.container.find(".section-description-buttons .section-description-close").on("click",function(){e.container.find(".section-meta .customize-section-description:first").removeClass("open").slideUp(),e.container.find(".customize-help-toggle").attr("aria-expanded","false").focus()}),t&&!t.setting.get()&&(e.container.find(".section-meta .customize-section-description:first").addClass("open").show().trigger("toggled"),e.container.find(".customize-help-toggle").attr("aria-expanded","true"))}),l.control("header_video",function(e){e.deferred.embedded.done(function(){var t=function(){var t=l.section(e.section()),n="video_header_not_available";t&&(e.active.get()?t.notifications.remove(n):t.notifications.add(new l.Notification(n,{type:"info",message:l.l10n.videoHeaderNotice})))};t(),e.active.bind(t)})}),l.previewer.bind("selective-refresh-setting-validities",function(e){l._handleSettingValidities({settingValidities:e,focusInvalidControl:!1})}),l.previewer.bind("focus-control-for-setting",function(e){var t=[];l.control.each(function(n){var i=_.pluck(n.settings,"id");-1!==_.indexOf(i,e)&&t.push(n)}),t.length&&(t.sort(function(e,t){return e.priority()-t.priority()}),t[0].focus())}),l.previewer.bind("refresh",function(){l.previewer.refresh()}),l.state("paneVisible").bind(function(e){var n;n=window.matchMedia?window.matchMedia("screen and ( max-width: 640px )").matches:t(window).width()<=640,l.state("editShortcutVisibility").set(e||n?"visible":"hidden")}),window.matchMedia&&window.matchMedia("screen and ( max-width: 640px )").addListener(function(){var e=l.state("paneVisible");e.callbacks.fireWith(e,[e.get(),e.get()])}),l.previewer.bind("edit-shortcut-visibility",function(e){l.state("editShortcutVisibility").set(e)}),l.state("editShortcutVisibility").bind(function(e){l.previewer.send("edit-shortcut-visibility",e)}),l.bind("change",e),t(document).one("tinymce-editor-setup",function(){window.tinymce.ui.FloatPanel&&(!window.tinymce.ui.FloatPanel.zIndex||window.tinymce.ui.FloatPanel.zIndex<500001)&&(window.tinymce.ui.FloatPanel.zIndex=500001)}),I.addClass("ready"),l.trigger("ready")}})})(wp,jQuery);